!function(){"use strict";function e(e,t,r,n,a){var i=this;i.changeLanguage=function(e){r.use(e)},i.translate=function(){t.go("result")},i.resetWorkspace=function(){n.debug("Cleared Workspace"),a.reset(),e.translatedJSON="In the near future the translated JSON will be here.",e.translatedSPARQL="In the near future the translated SPARQL will be here."}}angular.module("GSB.layout.workspace.navigation",[]).controller("WorkspaceNavigationCtrl",e),e.$inject=["$scope","$state","$translate","$log","SubjectService"]}(),function(){"use strict";function e(e,t,r,n,a){function i(e){e&&(t.addSubjectByURI(e),c.selectedSubject=void 0)}function o(t){e.offset.x=0,e.offset.y=0,u=t.pageX,p=t.pageY,d=!0,r.setVisibilityForAllConnection(!1)}function s(t){d&&(e.offset.x=t.pageX-u,e.offset.y=t.pageY-p,u=t.pageX,p=t.pageY)}function l(){e.offset.x=0,e.offset.y=0,d=!1,r.setVisibilityForAllConnection(!0),r.repaintEverything()}var c=this;c.x=t.x,c.groups=[],c.selectedSubject=void 0,c.availableSubjectClasses=[],c.subjects=t.subjects,c.getSubjects=t.getSubjects,c.addSubject=i,c.workspaceMouseDown=o,c.workspaceMouseMove=s,c.workspaceMouseUp=l,c.searchSubject=null,c.connections=n.getConnections,r.resetService();var u,p,d=!1;e.offset={x:0,y:0},e.$watch(t.getAvailableClasses,function(e){c.availableSubjectClasses=e},!0),e.$watch(t.getMainSubject,function(e){c.x=e},!0),e.$watchCollection(t.getSearchRelationSubjects,function(e){if(0===e.length&&(c.searchSubject=null),1===e.length&&(c.searchSubject=e[0]),2===e.length){var r=a.open({templateUrl:"modules/modals/findRelationModal.tpl.html",controller:"findRelationModalCtrl",resolve:{subjects:function(){return e},possibleRelations:["EndPointService",function(t){return t.getPossibleRelations(e[0].uri,e[1].uri)}]}});r.result.then(null,function(){t.searchRelation(null)})}},!0),e.$watchCollection(t.getGroups,function(e){c.groups=e},!0)}angular.module("GSB.layout.workspace",["GSB.modals","ngSanitize","ui.select","GSB.config","GSB.endPointService","GSB.parser","GSB.arrowService","LocalForageModule"]).controller("WorkspaceCtrl",e),e.$inject=["$scope","SubjectService","ArrowService","connectionService","$modal"]}(),function(){"use strict";function e(e,t){e.switchStatus=!1,t.$on("updateJSON",function(t,r){var n=new Blob([r],{type:"application/json"});e.blobURL=URL.createObjectURL(n)})}angular.module("GSB.layout",["GSB.layout.workspace","GSB.layout.workspace.navigation"]).controller("NavigationCtrl",e),e.$inject=["$scope","$rootScope"]}(),function(){"use strict";function e(e,t,r,n){function a(e){return e=n("beautifySPARQL")(e),e=n("replaceURIsWithPrefixes")(e)}function i(){var t="&format="+encodeURIComponent(e.currentFormat.format),n="&query="+encodeURIComponent(e.translatedSPARQL),a="";return r.defaultGraphURIs.forEach(function(e){a+="&default-graph-uri="+encodeURIComponent(e)}),e.currentFormat.qtxt&&(n="&qtxt="+encodeURIComponent(e.translatedSPARQL),a=""),-1===r.resultURL.indexOf("?")?r.resultURL+"?"+t+a+n:r.resultURL+t+a+n}e.resultHead=[],e.resultData=[],e.showQueries=!0,e.resultFormats=r.resultFormats,e.currentFormat=r.resultFormats[0],e.translatedJSON=t.json;var o="";_.forEach(r.prefixes,function(e,t){o+="prefix "+t+": <"+e+"> \n"}),e.translatedSPARQL=o+"\n"+a(t.sparql.toString()),e.openInNewTab=function(){var e=window.open(i(),"_blank");e.focus()}}function t(){return function(e,t){if(0===t.length)return e;var r=1;return _.startsWith(t[0],"-")&&(r=-1),t=t[0].substring(1),e.sort(function(e,n){return r*e[t].value.localeCompare(n[t].value)})}}angular.module("GSB.layout").filter("deepOrderBy",t).controller("ResultCtrl",e),e.$inject=["$scope","JSON","globalConfig","$filter"]}(),function(){"use strict";function e(e,n){return{restrict:"E",replace:!0,scope:{subject:"=",offset:"="},controller:t,controllerAs:"vm",templateUrl:"/modules/subject/subject.tpl.html",link:r(e,n)}}function t(e,t,r){function n(){o.addProperty(s.propertySelected),s.propertySelected=void 0,s.showAddProperty=!1}function a(){r.removeSubject(o.$id)}function i(){r.searchRelation(o)}var o=e.subject;t.addMapping(o.$id,e.$id);var s=this;s.editAlias=!1,s.comment=o.uri+".$comment",s.removeSubject=a,s.addProperty=n,s.searchRelation=i,e.$watch(o.getAvailableProperties,function(e){s.$availableProperties=e},!0)}function r(e,t){return function(r,n){function a(e,t){u=e,p=t,s.x=e,s.y=t,n.css({left:e+"px",top:t+"px"})}function i(e){p=e.pageY-c,u=e.pageX-l,t.repaintEverything(),a(e.pageX-l,e.pageY-c)}function o(){r.dragging=!1,r.$digest(),t.repaintEverything(),e.unbind("mousemove",i),e.unbind("mouseup",o)}var s=r.subject.pos,l=0,c=0,u=s.x||150,p=s.y||250;r.$watch("offset",function(e){a(u+e.x,p+e.y)},!0),n.find("mover").on("mousedown",function(t){t.preventDefault(),r.dragging=!0,l=t.pageX-u,c=t.pageY-p,e.on("mousemove",i),e.on("mouseup",o)})}}angular.module("GSB.subject.instance",["GSB.config","GSB.endPointService","GSB.arrowService","GSB.filters"]).directive("subjectDir",e),e.$inject=["$document","ArrowService"],t.$inject=["$scope","connectionService","SubjectService"]}(),function(){"use strict";angular.module("GSB.subject",["GSB.subject.model","GSB.subject.service","GSB.subject.instance","GSB.property"])}(),function(){"use strict";function e(e,t,r,n,a,i){function o(){return y}function s(e){2===y.length&&(y=[]),null!==e&&y.push(e)}function l(){var e=r.getGroups(),t=_.isEmpty(S.x.mainSubject)?null:angular.copy(S.x.mainSubject.$id),n=_.keys(e);if(S.groups=_.filter(S.subjects,function(e){return _.contains(n,e.$id)}),!_.contains(n,t)){var a=_.findKey(e,function(e){return _.contains(e,t)});S.x.mainSubject=_.find(S.groups,{$id:a})}return 1===S.groups.length&&(S.x.mainSubject=S.groups[0]),S.groups}function c(e){var t=_.where(S.subjects,{alias:e.linkTo});t.length>0&&(e.linkTo=t[0])}function u(e){S.x.mainSubject=_.where(S.subjects,{alias:e})[0]}function p(){return _.isEmpty(S.x.mainSubject)||w===S.x.mainSubject.$id||(w=S.x.mainSubject.$id,r.connect("startpoint",w,!1,"Start")),S.x}function d(){return S.subjects}function f(){var e=[];return S.availableSubjectClasses.forEach(function(t){e.push({uri:t.uri,label:t.uri+".$label",comment:t.uri+".$comment"})}),i("translateAndSortLocalizedObjectArrayByKey")(e,"label")}function m(e){var t={uri:e,$classURIs:[e]};g(t)}function g(r){t.debug("SUBJECT added "+r.uri,r);var n=new e(r);return S.subjects.push(n),n}function v(e){r.remove(e).then(function(){_.remove(S.subjects,{$id:e})})}function h(){S.subjects.forEach(function(e){v(e.$id)}),S.x.mainSubject=null,S.x.groups=[],t.debug("Workspace reset")}function b(e){return 0===_.filter(S.subjects,{alias:e}).length}var S={};S.subjects=[],S.x={mainSubject:null,groups:[]},S.groups=[],S.availableSubjectClasses=[];var y=[];S.addSubjectByURI=m,S.addSubject=g,S.removeSubject=v,S.isAliasUnique=b,S.reset=h,S.getAvailableClasses=f,S.getMainSubject=p,S.getSubjects=d,S.getSearchRelationSubjects=o,S.getSubjectById=function(e){return _.where(S.subjects,{$id:e})[0]},S.setMainSubjectWithAlias=u,S.linkSubjectWithProperty=c,S.getGroups=l,S.searchRelation=s;var w=null;return n.getAvailableClasses().then(function(e){t.debug("Classes loaded ",e),a.refresh(),S.availableSubjectClasses=e}).catch(function(e){t.error("An error occurred: ",e)}),S}angular.module("GSB.subject.service",["GSB.endPointService","GSB.language","GSB.subject.model","GSB.arrowService"]).factory("SubjectService",e),e.$inject=["Subject","$log","connectionService","EndPointService","$translate","$filter"]}(),function(){"use strict";function e(e,t,r,n,a,i){return function(o){function s(e){e.subject={uri:u.uri,$id:u.$id};var t=new a(e);return u.$selectedProperties.push(t),t}function l(e){i.remove(e).then(function(){_.remove(u.$selectedProperties,{$id:e})})}function c(){var e=[];return u.$availableProperties.forEach(function(t){t.comment=t.uri+".$comment",t.label=t.uri+".$label",e.push(t)}),n("translateAndSortLocalizedObjectArrayByKey")(e,"label")}var u={uri:null,pos:{},view:!0,$availableProperties:[],$classURIs:[],$id:null,$selectedProperties:[]};return _.extend(u,o),u.$id=i.generateID(),i.addSubject(u.$id),u.getAvailableProperties=c,u.addProperty=s,u.removeProperty=l,e.getSuperAndEqClasses(u.uri).then(function(e){t.debug("SUBJECT Additional Classes loaded for "+u.uri,e),u.$classURIs=e}).catch(function(e){t.error(e)}),e.getDirectProperties(u.uri).then(function(e){t.debug("PROPERTIES (direkt) loaded for "+u.uri,e),r.refresh(),u.$availableProperties=_.union(u.$availableProperties,e)}).catch(function(e){t.error("An error occurred: ",e)}),e.getInverseProperties(u.uri).then(function(e){t.debug("PROPERTIES (inverse) loaded for "+u.uri,e),r.refresh(),u.$availableProperties=_.union(u.$availableProperties,e)}).catch(function(e){t.error("An error occurred: ",e)}),u.alias||r(u.uri+".$label").then(function(e){var t=e;u.alias=t}),u}}angular.module("GSB.subject.model",["GSB.endPointService","pascalprecht.translate","GSB.connectionService"]).factory("Subject",e),e.$inject=["EndPointService","$log","$translate","$filter","Property","connectionService"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"=",hideLanguageFilter:"=hideLanguage"},templateUrl:"/modules/propertyType/string.tpl.html"}}function t(e,t,r){function n(e,t,r){return null===t||void 0===t||""===t||void 0===e||null===e?(i.compare=null,void a()):(i.compare=o.allowedStringComparisons[e].f.replace(/%input%/,t).replace(/%flags%/,r),void a())}function a(){i.compareRaw.selectedLanguage=o.selectedLanguage,null!==o.selectedLanguage&&void 0!==o.selectedLanguage&&""!==o.selectedLanguage&&(i.compare=null===i.compare||void 0===i.compare?'langMatches(lang(%after_arithmetic%), "'+o.selectedLanguage+'")':'langMatches(lang(%after_arithmetic%), "'+o.selectedLanguage+'") && '+i.compare)}var i=e.property,o=this,s=angular.copy(i.compareRaw);o.allowedStringComparisons=[{label:"CONTAINS",f:'regex(%after_arithmetic%, "%input%", "i")',showFlags:!1},{label:"EQUALS",f:'(str(%after_arithmetic%)="%input%")',showFlags:!1},{label:"EQUALS_NOT",f:'(str(%after_arithmetic%)!="%input%")',showFlags:!1},{label:"STARTS_WITH",f:'regex(%after_arithmetic%, "^%input%", "i")',showFlags:!1},{label:"ENDS_WITH",f:'regex(%after_arithmetic%, "%input%$", "i")',showFlags:!1},{label:"REGEX",f:'regex(%after_arithmetic%, "%input%", "%flags%")',showFlags:!0}],o.allowedLanguages=r.allowedLanguages,o.stringComparison=null,o.comparisonInput="",o.comparisonRegexFlags="i",o.selectedLanguage=null,o.getStringComparisonLabel=function(){return null===o.stringComparison?"NO_COMPARISON":o.allowedStringComparisons[o.stringComparison].label},o.changeStringComparison=function(e){o.stringComparison=e},null!==s&&void 0!==s&&(null!==s.selectedLanguage&&void 0!==s.selectedLanguage&&(o.selectedLanguage=s.selectedLanguage),null!==s.stringComparison&&void 0!==s.stringComparison&&(o.stringComparison=s.stringComparison),null!==s.comparisonInput&&void 0!==s.comparisonInput&&(o.comparisonInput=s.comparisonInput),null!==s.comparisonRegexFlags&&void 0!==s.comparisonRegexFlags&&(o.comparisonRegexFlags=s.comparisonRegexFlags)),e.$watch("vm.stringComparison",function(e){n(e,o.comparisonInput,o.comparisonRegexFlags),i.compareRaw.stringComparison=e,null!==e&&(o.showFlags=o.allowedStringComparisons[e].showFlags)}),e.$watch("vm.comparisonInput",function(e){i.compareRaw.comparisonInput=e,n(o.stringComparison,e,o.comparisonRegexFlags)}),e.$watch("vm.comparisonRegexFlags",function(e){i.compareRaw.comparisonRegexFlags=e,n(o.stringComparison,o.comparisonInput,e)}),e.$watch("vm.selectedLanguage",function(){a()})}angular.module("GSB.propertyType.string",["GSB.config"]).directive("stringPropertyDir",e),t.$inject=["$scope","$http","globalConfig"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{property:"="},controllerAs:"vm",controller:t,templateUrl:"/modules/propertyType/object.tpl.html"}}function t(e,t,r){function n(e){a=e}var a=null,i=this;i.subjects=t.subjects;var o=e.property;e.$watch("property.alias",function(e){r.updateConnectionLabel(a,e)}),e.$watch("property.linkTo",function(e){var t,a=angular.copy(o.$id),i=o.alias,s="INVERSE_PROPERTY"===o.type;void 0!==e&&null!==e&&(t=angular.copy(e.$id)),r.connect(a,t,s,i).then(n)})}function r(){return function(e,t,r){return null===t||void 0===t||"object"!=typeof r||0===r.length?e:e.filter(function(e){if(void 0===e[this.key])return!0;for(var t=0,r=this.filter.length;r>t;t++)if(-1!==e[this.key].indexOf(this.filter[t]))return!0;return!1},{key:t,filter:r})}}angular.module("GSB.propertyType.object",["GSB.arrowService","GSB.connectionService"]).directive("objectPropertyDir",e).filter("objectPropertyFilter",r),t.$inject=["$scope","SubjectService","connectionService"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"="},templateUrl:"/modules/propertyType/number.tpl.html"}}function t(e){var t=e.property,r=this,n=angular.copy(t.compareRaw);r.numberArithmetic="x",r.numberComparison="y",null!==n&&void 0!==n&&(null!==n.numberArithmetic&&void 0!==n.numberArithmetic&&(r.numberArithmetic=n.numberArithmetic),null!==n.numberComparison&&void 0!==n.numberComparison&&(r.numberComparison=n.numberComparison)),e.$watch("vm.numberArithmetic",function(e){(""===e||null===e||void 0===e)&&(e="x"),t.compareRaw.numberArithmetic=e,t.arithmetic="x"===e?null:e.replace(/x/g,"%before_arithmetic%")}),e.$watch("vm.numberComparison",function(e){(""===e||null===e||void 0===e)&&(e="y"),t.compareRaw.numberComparison=e,t.compare="x"===e||"y"===e?null:e.replace(/x/g,"%before_arithmetic%").replace(/y/g,"%after_arithmetic%")})}function r(){return{require:"ngModel",link:function(e,t,r,n){function a(e){return function(t){var r=new RegExp(e.limitInput,"g"),a=t.toLowerCase().replace(r,"");return a=a.replace(/\s+/g," "),a!==t&&(n.$setViewValue(a),n.$render()),a}}n.$parsers.push(a(r))}}}angular.module("GSB.propertyType.number",["GSB.config"]).directive("numberPropertyDir",e).directive("limitInput",r),t.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"="},templateUrl:"/modules/propertyType/date.tpl.html"}}function t(e){function t(){if(null!==n.dateComparison&&n.comparisonInput instanceof Date){var e=n.comparisonInput;r.compare=n.allowedDateComparisons[n.dateComparison].f.replace(/%input_start_of_day%/g,moment(e).hour(0).minute(0).second(0).format()).replace(/%input_end_of_day%/g,moment(e).hour(23).minute(59).second(59).format())}else r.compare=null}var r=e.property,n=this;n.open=function(e){e.preventDefault(),e.stopPropagation(),n.opened=!0};var a=angular.copy(r.compareRaw);n.allowedDateComparisons=[{label:"EQUALS",f:'xsd:dateTime(%after_arithmetic%) >= "%input_start_of_day%"^^xsd:dateTime&& xsd:dateTime(%after_arithmetic%) <= "%input_end_of_day%"^^xsd:dateTime'},{label:"EQUALS_NOT",f:'xsd:dateTime(%after_arithmetic%) < "%input_start_of_day%"^^xsd:dateTime|| xsd:dateTime(%after_arithmetic%) > "%input_end_of_day%"^^xsd:dateTime'},{label:"AFTER",f:'xsd:dateTime(%after_arithmetic%) > "%input_end_of_day%"^^xsd:dateTime'},{label:"BEFORE",f:'xsd:dateTime(%after_arithmetic%) < "%input_start_of_day%"^^xsd:dateTime'}],n.getDateComparisonLabel=function(e){return n.allowedDateComparisons[e].label},n.changeDateComparison=function(e){n.dateComparison=e},n.dateComparison=0,n.comparisonInput=new Date,null!==a&&void 0!==a&&(null!==a.dateComparison&&void 0!==a.dateComparison&&(n.dateComparison=a.dateComparison),null!==a.comparisonInput&&void 0!==a.comparisonInput&&(n.comparisonInput=new Date(a.comparisonInput))),e.$watch("vm.dateComparison",function(e){r.compareRaw.dateComparison=e,r.compare="",t()}),e.$watch("vm.comparisonInput",function(e){r.compareRaw.comparisonInput=e,r.compare="",t()})}angular.module("GSB.propertyType.date",["ui.bootstrap"]).directive("datePropertyDir",e),t.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{property:"="},controllerAs:"vm",controller:t,templateUrl:"/modules/propertyType/aggregate.tpl.html"}}function t(e,t){var r=e.property,n=this;n.availableProperties=[],e.$watchCollection(function(){return t.getSubjectById(r.subject.$id).$selectedProperties},function(e){n.availableProperties=_.reject(e,{type:"AGGREGATE_PROPERTY"})})}function r(){return function(e,t){return _.isEmpty(t)||(e=_.filter(e,{type:t})),e}}angular.module("GSB.propertyType.aggregate",[]).directive("aggregatePropertyDir",e).filter("aggregatePropertyFilter",r),t.$inject=["$scope","SubjectService"]}(),function(){"use strict";angular.module("GSB.propertyType",["GSB.propertyType.object","GSB.propertyType.aggregate","GSB.propertyType.number","GSB.propertyType.string","GSB.propertyType.date"])}(),function(){"use strict";function e(e,t,r,n,a){return function(i){var o={uri:null,type:null,filterExists:!0,hasFilter:!1,compareRaw:{},link:null,view:!0,optional:!1,arithmetic:null,compare:null,subject:{}};_.extend(o,i),o.$id=a.generateID(),a.addPropertyToSubject(o.subject.$id,o.$id),o.alias||r(o.uri+".$label").then(function(e){var t=e;o.alias=t});var s=function(t){if(!_.isEmpty(t)){var r=angular.copy(t),a=[];return r.forEach(function(t){a.push(e.getSubAndEqClasses(t))}),n.all(a).then(function(e){e=_.uniq(_.flatten(e)),o.$range=e}).then(function(){"INVERSE_PROPERTY"!==o.type&&"AGGREGATE_PROPERTY"!==o.type&&(o.type=e.getPropertyType(o))})}};return o.$copied?_.startsWith(o.uri,"$$")||e.getPropertyDetails(o.subject.uri,o).then(function(e){return e=e[0],_.isEmpty(e)?null:(o.$range=e.$range,o.type=e.type,e.$range)}).then(s).catch(function(e){t.error(e)}):s(o.$range),o}}angular.module("GSB.property.model",["GSB.endPointService","pascalprecht.translate","GSB.connectionService"]).factory("Property",e),e.$inject=["EndPointService","$log","$translate","$q","connectionService"]}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{property:"="},controller:t,controllerAs:"vm",templateUrl:"/modules/property/property.tpl.html"}}function t(e,t,r){var n=e.property;r.addMapping(n.$id,e.$id);var a=this;a.editAlias=!1,a.toggle=function(e){n.hasOwnProperty(e)&&(n[e]=!n[e])},a.removeProperty=function(e){_.where(t.subjects,{$id:n.subject.$id}).forEach(function(t){t.removeProperty(e)})}}angular.module("GSB.property.instance",["GSB.config","GSB.filters","GSB.arrowService"]).directive("propertyDir",e),t.$inject=["$scope","SubjectService","connectionService"]}(),function(){"use strict";angular.module("GSB.property",["GSB.property.model","GSB.property.instance","GSB.propertyType"])}(),function(){"use strict";function e(e,t){return{link:function(r,n){n.bind("change",function(r){var a=new FileReader;a.onload=function(r){n.val(null);var a=JSON.parse(r.target.result);t.reset(),e.translateJSONToGSBL(a)},a.readAsText(r.target.files[0])})}}}function t(e,t,r){var n={};return n.translateGSBLToSPARQL=function(){var n=t.translateGSBLToJSON();if(null===n)return void e.error("JSON is not valid / empty");var a=r.translateJSONToSPARQL(JSON.parse(n)),i=r.translateJSONToSponateMap(JSON.parse(n));return{json:n,sparql:a,sponateMap:i}},n}angular.module("GSB.parser",["GSB.config","GSB.parser.GSBL2JSON","GSB.parser.GSBL2SPARQL","GSB.parser.JSON2GSBL","LocalForageModule"]).factory("TranslatorManager",t).directive("jsonreader",e),e.$inject=["TranslatorToGSBL","SubjectService"],t.$inject=["$log","TranslatorToJSON","TranslatorToSPARQL"]}(),function(){"use strict";function e(e,t){e.state("workspace",{url:"/workspace",views:{content:{controller:"WorkspaceCtrl",controllerAs:"vm",templateUrl:"/modules/layout/workspace/content.tpl.html"},navigation:{controller:"WorkspaceNavigationCtrl",controllerAs:"vm",templateUrl:"/modules/layout/workspace/navigation.tpl.html"}}}),e.state("result",{url:"/result",views:{content:{controller:"ResultCtrl",controllerAs:"vm",templateUrl:"/modules/layout/result/content.tpl.html",resolve:{JSON:["TranslatorManager","$timeout",function(e,t){return t(function(){return e.translateGSBLToSPARQL()},300)}]}},navigation:{templateUrl:"/modules/layout/result/navigation.tpl.html"}}}),t.otherwise("/workspace")}angular.module("GSB",["GSB.config","GSB.layout","GSB.filters","GSB.subject","GSB.mainCtrl","GSB.language","ui.router"]).run(["$localForage","globalConfig","TranslatorToGSBL",function(e,t,r){e.getItem("current").then(function(e){null!==e&&e.CONFIG===t.name&&r.translateJSONToGSBL(e)})}]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).config(["uiSelectConfig",function(e){e.theme="bootstrap"}]).config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),angular.module("GSB").run(["$templateCache",function(e){e.put("/modules/modals/findRelationModal.tpl.html",'<div class=modal-header><h1 class="modal-title h4">Possible relations between {{subject1}} and {{subject2}}</h1></div><div class=modal-body><div ng-repeat="(idx,subject) in subjects track by $index" ng-if="(!dontShowSecond || idx === 0) && subject.$availableProperties.length > 0"><h2 ng-if="idx === 0" class=h5>{{subject1}} -> ??? -> {{subject2}}</h2><h2 ng-if="idx === 1" class=h5>{{subject2}} -> ??? -> {{subject1}}</h2><div class=list-group><a class=list-group-item ng-class="(selected === property && fromIDX === idx)?\'active\':\'\'" ng-repeat="property in subject.$availableProperties" ng-click=select(property,idx)><i class="fa fa-fw fa-question-circle pull-right" style="line-height: 20px" ng-if="(property.comment | translate) !== property.comment" popover="{{property.comment | translate}}" popover-trigger=mouseenter popover-append-to-body=true></i> {{ property.label | translate }} <small>({{property.uri | replaceURIsWithPrefixes}})</small></a></div></div><div ng-if=selected>Do you want to create the property:<br>{{subjects[fromIDX].alias}} -> <b>{{selected.label | translate}}</b> -> {{subjects[toIDX].alias}}?</div></div><div class=modal-footer><button class="btn btn-primary" ng-click=ok()>Create Property</button> <button class="btn btn-warning" ng-click=cancel()>Cancel</button></div>'),e.put("/modules/property/property.tpl.html",'<div class=propertyCSS ng-class="property.filterExists ? \'\' : \'notExists\'" id={{$id}}><div class=propertyHeadCSS><p><div class="dropdown pull-right icon-list" on-toggle=toggled(open)>&nbsp;<i class="fa fa-fw fa-ellipsis-h dropdown-toggle"></i><ul class=dropdown-menu role=menu><li ng-show="property.filterExists && property.hasFilter"><a href="" ng-click="vm.toggle(\'hasFilter\')"><i class="fa fa-fw fa-filter"></i> {{\'REMOVE_FILTER\' | translate}}</a></li><li ng-show="property.filterExists && !property.hasFilter"><a href="" ng-click="vm.toggle(\'hasFilter\')"><i class="fa fa-fw fa-filter"></i> {{\'ADD_FILTER\' | translate}}</a></li><li ng-show=property.filterExists><a href="" ng-click="vm.toggle(\'filterExists\')"><i class="fa fa-fw fa-square-o"></i> {{\'EXISTS_NOT\' | translate}}</a></li><li ng-hide=property.filterExists><a href="" ng-click="vm.toggle(\'filterExists\')"><i class="fa fa-fw fa-check-square-o"></i> {{\'EXISTS\' | translate}}</a></li><li ng-show="property.filterExists && !property.optional"><a href="" ng-click="vm.toggle(\'optional\')"><i class="fa fa-fw fa-question-circle"></i> {{\'IS_OPTIONAL\' | translate}}</a></li><li ng-show="property.filterExists && property.optional"><a href="" ng-click="vm.toggle(\'optional\')"><i class="fa fa-fw fa-exclamation-circle"></i> {{\'IS_MANDATORY\' | translate}}</a></li><li ng-hide=property.view><a href="" ng-click="vm.toggle(\'view\')"><i class="fa fa-fw fa-eye"></i> {{\'SHOW_PROPERTY\' | translate}}</a></li><li ng-show=property.view><a href="" ng-click="vm.toggle(\'view\')"><i class="fa fa-fw fa-eye-slash"></i> {{\'HIDE_PROPERTY\' | translate}}</a></li><li><a href="" ng-click=vm.removeProperty(property.$id)><i class="fa fa-fw fa-trash-o"></i> {{\'DELETE_PROPERTY\' | translate}}</a></li></ul></div><span class="pull-right icon-list"><i class="fa fa-square-o fa-fw" ng-hide=property.filterExists ng-click="vm.toggle(\'filterExists\')"></i> <i class="fa fa-fw fa-question-circle" ng-show="property.filterExists && property.optional" ng-click="vm.toggle(\'optional\')"></i> <i class="fa fa-fw fa-eye-slash" ng-hide=property.view ng-click="vm.toggle(\'view\')"></i> <i class="fa fa-fw fa-info-circle" ng-if="(property.uri + \'.$comment\' | translate) !== property.uri + \'.$comment\'" popover="{{property.uri +\'.$comment\' | translate}}" popover-trigger="{{dragging ? \'none\' : \'mouseenter\'}}" popover-placement=top popover-append-to-body=true></i></span> <b><span class=h5><b>{{property.alias}}<span ng-if="property.type === \'INVERSE_PROPERTY\'" class=text-danger>&#x207b;&#x00b9;</span></b></span> <i class="fa fa-edit pointer" ng-click="vm.editAlias = true"></i> <small><small>({{ property.uri | replaceURIsWithPrefixes}})</small></small></b></p><div class=input-group ng-show=vm.editAlias><input size=30 maxlength=40 class=form-control placeholder=Alias ng-model=property.alias><div class=input-group-btn><button class="btn btn-success" ng-click="vm.editAlias = false"><i class="fa fa-check-square-o"></i></button></div></div><div class=clearfix></div></div><div class=propertyBodyCSS><div class=propertyFilters ng-show="property.filterExists && property.hasFilter" ng-switch on=property.type><div ng-switch-when=AGGREGATE_PROPERTY aggregate-property-dir property=property></div><div ng-switch-when=OBJECT_PROPERTY object-property-dir property=property></div><div ng-switch-when=NUMBER_PROPERTY number-property-dir property=property></div><div ng-switch-when=STRING_PROPERTY string-property-dir property=property hide-language="property.uri === \'$$uri\'"></div><div ng-switch-when=STANDARD_PROPERTY string-property-dir property=property hide-language="property.uri === \'$$uri\'"></div><div ng-switch-when=INVERSE_PROPERTY object-property-dir property=property></div><div ng-switch-when=DATE_PROPERTY date-property-dir property=property></div><div ng-switch-default></div></div><div class=clearfix></div></div></div>'),e.put("/modules/propertyType/aggregate.tpl.html",'<div><select ng-model=property.linkTo ng-options="x as x.alias for x in vm.availableProperties | aggregatePropertyFilter : property.restrictTo"><option value="">Choose a Property</option></select></div>'),e.put("/modules/propertyType/date.tpl.html",'<div><div class="input-group input-group-sm"><div class="input-group-btn dropdown" is-open=status.isopen><button type=button class="btn btn-default dropdown-toggle">{{ vm.getDateComparisonLabel(vm.dateComparison) | translate}} <span class=caret></span></button><ul class=dropdown-menu role=menu><li ng-repeat="(idx,x) in vm.allowedDateComparisons"><a href="" ng-click=vm.changeDateComparison(idx)>{{x.label | translate}}</a></li></ul></div><input class=form-control datepicker-popup=yyyy-MM-dd ng-model=vm.comparisonInput is-open=vm.opened datepicker-options="{ formatYear: \'yy\', startingDay: 1}" ng-required=true close-text="Close"> <span class=input-group-btn><button type=button class="btn btn-default" ng-click=vm.open($event)><i class="fa fa-calendar"></i></button></span></div></div>'),e.put("/modules/propertyType/number.tpl.html",'<div><div class="input-group input-group-sm"><div class=input-group-addon>{{\'ARITHMETICS\' | translate}}</div><input class=form-control ng-model=vm.numberArithmetic limit-input="[^\\-\\*\\/\\.\\+()\\d xe]"></div><div class="input-group input-group-sm" style="margin-top: 5px"><div class=input-group-addon>{{\'COMPARISON\' | translate}}</div><input class=form-control ng-model=vm.numberComparison limit-input="[^\\-\\*\\/\\.\\+()><=!\\d xye]"></div></div>'),e.put("/modules/propertyType/object.tpl.html",'<div><div class="input-group input-group-sm"><div class=input-group-addon>{{\'A_LINK_TO\' | translate}}</div><select ng-model=property.linkTo class="form-control input-sm" ng-options="x as x.alias for x in vm.subjects | objectPropertyFilter : \'$classURIs\' : property.$range" title="Link with a subject"><option value="">{{\'LINK_WITH_SUBJECT\' | translate}}</option></select><div class=input-group-addon>{{\'EXISTS\' | translate}}</div></div></div>'),e.put("/modules/propertyType/string.tpl.html",'<div><div class="input-group input-group-sm"><div class=input-group-addon>{{\'COMPARISON\' | translate}}</div><div class="input-group-btn dropdown" is-open=dd2.isopen><button type=button class="btn dropdown-toggle btn-default" style="border-radius: 0;border-right: 0">{{vm.getStringComparisonLabel() | translate}} <span class=caret></span></button><ul class=dropdown-menu role=menu><li><a href="" ng-click=vm.changeStringComparison(null)>{{}}</a></li><li ng-repeat="(idx,x) in vm.allowedStringComparisons"><a href="" ng-click=vm.changeStringComparison(idx)>{{x.label | translate}}</a></li></ul></div><input ng-disabled="vm.stringComparison === null" class="form-control input-sm" ng-model=vm.comparisonInput> <span ng-show=vm.showFlags class=input-group-btn style=width:0></span> <input ng-show=vm.showFlags class="form-control input-sm" ng-model=vm.comparisonRegexFlags style="border-left:0"></div><div class="input-group input-group-sm" style="margin-top: 5px" ng-if=!hideLanguageFilter><div class=input-group-addon>{{\'LANGUAGE\' | translate}}</div><select ng-model=vm.selectedLanguage ng-options="x as x for x in vm.allowedLanguages" title="Select Language" class="form-control input-sm"><option value="">{{\'SELECT_LANGUAGE\' | translate}}</option></select></div></div>'),e.put("/modules/subject/subject.tpl.html",'<div class="subjectCSS box" id={{$id}}><div class=subjectHeadCSS><p><span class="pull-right icon-list"><mover><i class="fa fa-fw fa-arrows"></i></mover><i class="fa fa-fw fa-info-circle" ng-if="(vm.comment | translate) !== vm.comment" popover="{{vm.comment | translate}}" popover-trigger="{{dragging ? \'none\' : \'mouseenter\'}}" popover-placement=right popover-append-to-body=true></i> <i class="fa fa-fw fa-eye" ng-click="subject.view = !subject.view" ng-class="(subject.view)?\'fa-eye\':\'fa-eye-slash\'" popover="{{(subject.view)?\'HIDE_SUBJECT\':\'SHOW_SUBJECT\' | translate}}" popover-trigger="{{dragging ? \'none\' : \'mouseenter\'}}" popover-placement=right popover-append-to-body=true></i> <i class="fa fa-fw fa-plug" ng-click=vm.searchRelation()></i> <i class="fa fa-fw fa-trash-o" ng-click=vm.removeSubject()></i></span> <b><span class=h4>{{subject.alias}}</span> <i class="fa fa-edit pointer" ng-click="vm.editAlias = !vm.editAlias"></i> <small><small>({{ subject.uri | replaceURIsWithPrefixes}})</small></small></b></p><p class="input-group pull-left" ng-show=vm.editAlias><input size=30 maxlength=40 class=form-control placeholder=Alias ng-model=subject.alias> <span class="btn input-group-addon btn-success" ng-click="vm.editAlias = false"><i class="fa fa-check-square-o"></i></span></p></div><div class=subjectBodyCSS><div class=clearfix></div><property-dir property=property ng-repeat="property in subject.$selectedProperties"></property-dir><div ng-hide=vm.showAddProperty class=text-center><div class="btn btn-sm btn-success" ng-click="vm.showAddProperty = true"><span class="fa fa-plus"></span> {{ \'PROPERTY\' | translate }}</div></div><div ng-show=vm.showAddProperty style="margin: 0 25px"><div class=row><div class=input-group><ui-select ng-model=vm.propertySelected><ui-select-match placeholder="{{ \'CHOOSE_A_PROPERTY\' | translate }}">{{$select.selected.uri + \'.$label\' | translate}}</ui-select-match><ui-select-choices group-by="\'type\'" repeat="item in vm.$availableProperties |\n                                        filter: $select.search |\n                                        limitTo: 50"><p style="margin: 0"><i class="fa fa-info-circle pull-right" ng-if="(item.comment | translate) !== item.comment" popover="{{item.comment | translate}}" popover-trigger=mouseenter popover-append-to-body=true></i> <strong ng-bind-html="item.label | highlight: $select.search "></strong> <small><small ng-bind-html="item.uri | replaceURIsWithPrefixes"></small></small></p></ui-select-choices></ui-select><span class=input-group-btn><button ng-click=vm.addProperty() class="btn btn-success"><span class="fa fa-plus"></span></button></span></div></div></div></div></div>'),e.put("/modules/layout/result/content.tpl.html",'<div class=container><div ng-show=showQueries class=col-sm-12><div class="col-sm-12 text-center"><a href="" ng-click="showQueries = false">{{ \'HIDE_QUERIES\' | translate }}</a></div><h3>{{ \'QUERIES\' | translate }}</h3><div class=col-sm-6><p>{{ \'JSON\' | translate }}:</p><pre id=json-query>{{translatedJSON | replaceURIsWithPrefixes}}</pre></div><div class=col-sm-6><p>{{ \'SPARQL\' | translate }}</p><pre id=sparql-query>{{translatedSPARQL}}</pre></div></div><div class="col-sm-12 text-center"><a href="" ng-show=showQueries ng-click="showQueries = false">{{ \'HIDE_QUERIES\' | translate }}</a> <a href="" ng-hide=showQueries ng-click="showQueries = true">{{ \'SHOW_QUERIES\' | translate }}</a></div><div class=col-sm-12><h3>{{ \'RESULTS\' | translate }}</h3><p>Format results as<select ng-model=currentFormat ng-options="format.name for format in resultFormats"></select>and <a href="" ng-click=openInNewTab()>show results!</a></p><table ng-table=tableParams show-filter=true class="table table-responsive table-striped"><thead><tr><th ng-repeat="column in resultHead" ng-show=column.visible class="text-center sortable" ng-class="{\n                    \'sort-asc\': tableParams.isSortBy(column.sortable, \'asc\'),\n                    \'sort-desc\': tableParams.isSortBy(column.sortable, \'desc\')\n                  }" ng-click="tableParams.sorting(column.sortable, tableParams.isSortBy(column.sortable, \'asc\') ? \'desc\' : \'asc\')">{{column.title}}</th></tr><tr style="background-color: #fff"><th ng-repeat="column in resultHead" ng-show=column.visible class=filter><input ng-show=column.visible ng-model=params.filter()[column.field] class="input-filter form-control"></th></tr></thead><tbody><tr ng-repeat="user in $data"><td ng-repeat="column in resultHead" ng-show=column.visible sortable><span ng-switch=resultType(user[column.field])><span ng-switch-when=uri><a ng-href={{user[column.field].id}}><span ng-if=user[column.field].label>{{user[column.field].label}}</span> <span ng-if=!user[column.field].label>{{extractLabelFromURI(user[column.field].id)}}</span></a></span> <span ng-switch-when=lexicalValue>{{user[column.field].lexicalValue}} <small><small class=ng-binding>({{user[column.field].datatypeUri}})</small></small></span> <span ng-switch-default>{{user[column.field]}}</span></span></td></tr></tbody></table></div></div>'),e.put("/modules/layout/result/navigation.tpl.html",'<div class=list-group><a class=list-group-item ui-sref=workspace><i class="fa fa-fw fa-3x fa-backward"></i> <span class=list-group-item-description>{{ \'BACK_TO_WORKSPACE\' | translate }}</span></a> <a class=list-group-item ng-href="{{ blobURL }}" download=query.json target=_blank><i class="fa fa-fw fa-3x fa-download"></i> <span class=list-group-item-description>{{ \'DOWNLOAD_JSON\' | translate }}</span></a> <a class=list-group-item><i class="fa fa-fw fa-3x fa-question"></i> <span class=list-group-item-description>{{ \'HELP\' | translate }}</span></a></div>'),e.put("/modules/layout/workspace/content.tpl.html",'<div ng-mousedown=vm.workspaceMouseDown($event) ng-mousemove=vm.workspaceMouseMove($event) ng-mouseup=vm.workspaceMouseUp() class=bg-scroll></div><div id=workspace><div class=startPointCSS id=startpoint><b>{{ \'LIST_ALL\' | translate }}</b><select ng-show="vm.groups.length > 0" ng-model=vm.x.mainSubject ng-options="s.alias for s in vm.groups | orderBy : \'alias\'" title="Main Subject Select" class=pull-right><option style=display:none value="">{{ \'PICK_MAIN_SUBJECT\' | translate }}</option></select></div><div class=connectNotification ng-if=vm.searchSubject><b>{{\'SEARCH_RELATION\' | translate:vm.searchSubject}}</b></div><div class="addSubjectBox form-group pull-right"><div class=input-group><ui-select ng-model=vm.selectedSubject><ui-select-match placeholder="{{ \'CHOOSE_A_SUBJECT\' | translate }}">{{$select.selected.label}}</ui-select-match><ui-select-choices repeat="item.uri as item in vm.availableSubjectClasses |\n                        filter: $select.search |\n                        limitTo: 50"><p style="margin: 0"><i class="fa fa-info-circle pull-right" ng-if="(item.comment | translate) !== item.comment" popover="{{item.comment | translate}}" popover-trigger=mouseenter popover-placement=left popover-append-to-body=true></i> <strong ng-bind-html="item.label | highlight: $select.search"></strong> <small><small ng-bind-html="item.uri | replaceURIsWithPrefixes"></small></small></p></ui-select-choices></ui-select><span class=input-group-btn><button ng-click=vm.addSubject(vm.selectedSubject) class="btn btn-success"><span class="fa fa-plus"></span></button></span></div></div><subject-dir subject=subjectInst offset=offset ng-repeat="subjectInst in vm.subjects"></subject-dir></div>'),e.put("/modules/layout/workspace/navigation.tpl.html",'<div class=list-group><a class=list-group-item ng-click=vm.translate()><i class="fa fa-fw fa-3x fa-play-circle"></i> <span class=list-group-item-description>{{ \'RUN_QUERY\' | translate }}</span></a> <a class=list-group-item ng-click=vm.resetWorkspace()><i class="fa fa-fw fa-3x fa-undo"></i> <span class=list-group-item-description>{{ \'RESET_WORKSPACE\' | translate }}</span></a> <span class=list-group-item><i class="fa fa-fw fa-3x fa-upload"></i> <input type=file id=JSONReader name=JSONReader jsonreader> <span class=list-group-item-description>{{ \'LOAD_JSON\' | translate }}</span></span> <a class=list-group-item ng-click=CallMe(2)><i class="fa fa-fw fa-3x fa-question"></i> <span class=list-group-item-description>{{ \'HELP\' | translate }}</span></a> <a class=list-group-item><i class="fa fa-fw fa-3x fa-language"></i> <span class=list-group-item-description><button ng-click="vm.changeLanguage(\'de\')" translate=BUTTON_LANG_DE></button> <button ng-click="vm.changeLanguage(\'en\')" translate=BUTTON_LANG_EN></button></span></a></div>')
}]),function(){"use strict";function e(e,t){var r={};return r.translateJSONToGSBL=function(r){if(t.debug("Translate JSON to GSBL"),null===r)return t.error("Empty JSON File"),null;var n=[];r.SUBJECTS.forEach(function(t){t.$copied=!0;var r=t.properties;delete t.properties;var a=[];t=e.addSubject(t),r.forEach(function(e){e.$copied=!0,e=t.addProperty(e),e.linkTo&&("AGGREGATE_PROPERTY"!==e.type?n.push(e):a.push(e))}),a.forEach(function(e){var r=_.where(t.$selectedProperties,{alias:e.linkTo});r.length>0&&(e.linkTo=r[0])})}),n.forEach(function(t){e.linkSubjectWithProperty(t)}),e.setMainSubjectWithAlias(r.START.linkTo)},r}angular.module("GSB.parser.JSON2GSBL",["GSB.config","GSB.property.model","GSB.subject.model"]).factory("TranslatorToGSBL",e),e.$inject=["SubjectService","$log"]}(),function(){"use strict";function e(){function e(e){var t=new RegExp("[^A-Za-z0-9_?]","g");return e.replace(t,"_").replace(/_+/g,"_").replace(/^_|_$/,"")}function t(t,r,n,a,i){return null!==a&&(n=d.NodeFactory.createVar(e(a)),i=!1),{s:t,p:r,o:n,view:i}}function r(t,r,n){var a=e(r+" "+t.linkTo),i=e(a+" "+t.uri),c=d.NodeFactory.createVar(i),u=d.NodeFactory.createVar(a);return t.operator=t.operator.replace(/%alias%/g,u),n&&!o.contains(c)&&l.add(c,t.operator),s.add(u),[]}function n(n,a,i){var s,l=e(a+" "+n.alias),c=n.uri,u=n.type,f=new p.ElementTriplesBlock,g=d.NodeFactory.createVar(a),v=d.NodeFactory.createUri(c),h=d.NodeFactory.createVar(l),b=h,S=i&&n.view;return"AGGREGATE_PROPERTY"===u?r(n,a,S):"$$uri"===c?(null!==n.compare&&(n.compare=n.compare.replace(/%before_arithmetic%/g,g).replace(/%after_arithmetic%/g,g),f.addTriples([new p.ElementFilter(n.compare)])),f):("INVERSE_PROPERTY"===u?(s=t(g,v,h,n.linkTo,S),g=s.o,b=s.s,S=s.view,u="OBJECT_PROPERTY"):"OBJECT_PROPERTY"===u&&(s=t(g,v,h,n.linkTo,S),b=s.o,S=s.view),n.filterExists?(n.hasFilter&&null!==n.arithmetic&&(b=d.NodeFactory.createVar(e(l+" temp"))),f.addTriples([new d.Triple(g,v,b)]),n.hasFilter&&(null!==n.arithmetic&&(n.arithmetic=n.arithmetic.replace(/%before_arithmetic%/g,b).replace(/%after_arithmetic%/g,h),f.addTriples([new p.ElementBind(h,n.arithmetic)])),null!==n.compare&&(n.compare=n.compare.replace(/%before_arithmetic%/g,b).replace(/%after_arithmetic%/g,h),f.addTriples([new p.ElementFilter(n.compare)]))),S&&!o.contains(d.NodeFactory.createVar(l))&&(o.add(d.NodeFactory.createVar(l)),"OBJECT_PROPERTY"===u&&m.add(d.NodeFactory.createVar(l)))):f.addTriples([new p.ElementFilter(new p.E_NotExists(new d.Triple(g,v,h)))]),n.optional?new p.ElementOptional(f):f)}function a(t){var r=e(t.alias),a=d.NodeFactory.createVar(e(r)),i=d.NodeFactory.createUri(t.uri),s=new p.ElementTriplesBlock;return s.addTriples([new d.Triple(a,f.rdf.type,i)]),t.view&&!o.contains(a,r)&&(o.add(a),m.add(a),""===g&&(g=a)),t.hasOwnProperty("properties")&&t.properties.forEach(function(e){s.addTriples(n(e,r,t.view))}),s}function i(e){var t=new p.VarExprList;return o.entries().forEach(function(e){s.contains(e.v)||t.add(e.v,e.expr)}),e||l.entries().forEach(function(e){s.contains(e.v)||t.add(e.v,e.expr)}),t}var o,s,l,c={},u=new Jassa(Promise,$.ajax),p=u.sparql,d=u.rdf,f=u.vocab,m=new p.VarExprList,g="";return c.translateJSONToSPARQL=function(e){l=new p.VarExprList,o=new p.VarExprList,s=new p.VarExprList;var t=new p.Query,r=new p.ElementTriplesBlock;return e.hasOwnProperty("SUBJECTS")&&e.SUBJECTS.forEach(function(e){r.addTriples(a(e))}),t.setQueryPattern(r),t.setProjectVars(i()),t.setDistinct(!0),l.entries().length>0&&(t.groupBy=i(!0).vars),t},c.translateJSONToSponateMap=function(e){l=new p.VarExprList,m=new p.VarExprList,g="",o=new p.VarExprList,s=new p.VarExprList;var t,r=new p.ElementTriplesBlock;return e.hasOwnProperty("SUBJECTS")&&e.SUBJECTS.forEach(function(e){r.addTriples(a(e))}),t={name:(new Date).toISOString(),template:[{id:g.toString(),rows:[{id:"?rowId"}]}],from:r.toString()},i().getVars().forEach(function(e){var r=e.toString().replace(/^\?/,"");m.contains(e)&&(r="$"+r),t.template[0].rows[0][r]=e.toString()}),t},c}angular.module("GSB.parser.GSBL2SPARQL",[]).factory("TranslatorToSPARQL",e)}(),function(){"use strict";function e(e,t,r,n,a){var i=function(e){for(var t in e)e.hasOwnProperty(t)&&_.startsWith(t,"$")&&delete e[t];return e},o={};return o.translateGSBLToJSON=function(){t.debug("Translate GSBL to JSON");var o={CONFIG:r.name,START:{type:"LIST_ALL",linkTo:a.getMainSubject().mainSubject.alias},SUBJECTS:[]},s=_.cloneDeep(a.getSubjects());return s.map(function(e){return e.properties=e.$selectedProperties.map(function(e){return e.linkTo="STANDARD_PROPERTY"!==e.type&&e.hasOwnProperty("linkTo")&&null!==e.linkTo&&e.linkTo.hasOwnProperty("alias")?e.linkTo.alias:null,i(e)}),i(e)}),o.SUBJECTS=s,n.set("current",o).then(function(){t.debug("Current Workspace saved into localForage")}),e.$emit("updateJSON",JSON.stringify(o,null,2)),JSON.stringify(o,null,2)},o}angular.module("GSB.parser.GSBL2JSON",["GSB.config"]).factory("TranslatorToJSON",e),e.$inject=["$rootScope","$log","globalConfig","$localForage","SubjectService"]}(),function(){"use strict";function e(e,t,r,n,a){function i(e){return _(e).where({type:"OBJECT_PROPERTY"}).filter(function(e){return _.contains(r,e.uri)}).value()}e.subjects=_.cloneDeep(t),e.subjects[0].$availableProperties=i(t[0].$availableProperties),e.subjects[1].$availableProperties=i(t[1].$availableProperties),e.subjects[0].$id===e.subjects[1].$id&&(e.dontShowSecond=!0),e.subject1=t[0].alias,e.subject2=t[1].alias,e.selected=null,e.fromIDX=null,e.select=function(t,r){e.selected===t&&e.fromIDX===r?(e.selected=null,e.fromIDX=null):(e.selected=t,e.fromIDX=r,e.toIDX=0===r?1:0)},e.ok=function(){var r=n.getSubjectById(t[e.fromIDX].$id),i=n.getSubjectById(t[e.toIDX].$id),o=r.addProperty(angular.copy(e.selected));o.hasFilter=!0,o.linkTo=i,a.dismiss()},e.cancel=a.dismiss}angular.module("GSB.modals",["ui.bootstrap","GSB.subject.service"]).controller("findRelationModalCtrl",e),e.$inject=["$scope","subjects","possibleRelations","SubjectService","$modalInstance"]}(),function(){"use strict";function e(e){return function(t,r,n){if(!r)return t;n||(n="");var a=angular.copy(t);return a.map(function(t){return t[r]=e.instant(n+t[r]),t}).sort(function(e,t){return"string"==typeof e[r]&&"string"==typeof t[r]?e[r].toLowerCase().localeCompare(t[r].toLowerCase()):void 0})}}function t(e,t){t.fallBackLanguages.push("default"),e.useLoader("languageLoader").fallbackLanguage(t.fallBackLanguages).determinePreferredLanguage()}function r(e){return function(t){return e.getItem(t.key)}}function n(e){var t={"default":{ADD_A_AGGREGATE:"Add an aggregate",ADD_FILTER:"add filter",AFTER:"after",ARITHMETICS:"arithmetics",A_LINK_TO:"a link to",BACK_TO_WORKSPACE:"Workspace",BEFORE:"before",BUTTON_LANG_DE:"german",BUTTON_LANG_EN:"english",CHOOSE_A_PROPERTY:"Choose a property",CHOOSE_A_SUBJECT:"Choose a subject",COMPARISON:"comparison",CONTAINS:"contains",DELETE_PROPERTY:"delete property",DOWNLOAD_JSON:"Download JSON",ENDS_WITH:"ends with",EQUALS:"equals",EQUALS_NOT:"equals not",EXISTS:"exists",EXISTS_NOT:"exists not",HIDE_PROPERTY:"hide property",HIDE_QUERIES:"hide queries",IS_MANDATORY:"is mandatory",IS_OPTIONAL:"is optional",JSON:"JSON",LANGUAGE:"language",LINK_WITH_SUBJECT:"Link with a subject",LIST_ALL:"List all",LOAD_JSON:"Load JSON",NO_COMPARISON:"no comparison",PICK_MAIN_SUBJECT:"Pick a main subject",PROPERTY:"property",QUERIES:"Queries",REGEX:"regex",REMOVE_FILTER:"remove filter",RESET_WORKSPACE:"Reset Workspace",RESULTS:"Results",RUN_QUERY:"Run Query",SEARCH_RELATION:"To Search a Relation between {{alias}} and another subject, please click on the plug button of this subject.",SELECT_LANGUAGE:"Select a language",SHOW_PROPERTY:"show property",SHOW_QUERIES:"show queries",SPARQL:"SPARQL",STARTS_WITH:"starts with",WORKSPACE:"Workspace",TITLE:"Graphical SPARQL Builder"}},r={};return r.mergeLanguages=function(e){t=_.merge(t,e)},r.setItem=function(e,r,n){t.hasOwnProperty(e)||(t[e]={}),t[e][r]=n},r.getItem=function(r){var n=e.defer();return n.resolve(t.hasOwnProperty(r)?t[r]:{}),n.promise},r}angular.module("GSB.language",["GSB.config","pascalprecht.translate"]).config(t).factory("languageStorage",n).factory("languageLoader",r).filter("translateAndSortLocalizedObjectArrayByKey",e),e.$inject=["$translate"],t.$inject=["$translateProvider","globalConfig"],r.$inject=["languageStorage"],n.$inject=["$q"]}(),function(){"use strict";function e(e,t){function r(){return y}function n(e,r){t.updateConnectionLabel(e,r)}function a(){return g+=1,"i"+g}function i(e){return function(){delete h[e],delete v[e],delete b[e],c()}}function o(t){var r=[];return h.hasOwnProperty(t)?r=_.map(h[t],function(e){return s(e).then(i(e))}).push(s(t).then(i(t))):(r.push(s(t).then(i(t))),h=_.mapValues(h,function(e){return _.without(e,t)})),e.all(r).then(i(t))}function s(r){return e.when(d(r)).then(function(e){return t.deleteAllConnections(e)}).then(function(e){return delete S[r],c(),e})}function l(r,n,a,i){return s(r).then(function(){return e.all({source:d(r),target:d(n)})}).then(function(e){return e.target?(S[r]=n,c(),b[r]===n?t.connectToSelf(e.source):t.connect(e.source,e.target,i,a)):void 0})}function c(){var e=[];_.forEach(h,function(t,r){e.push([r,r])}),_.forEach(S,function(t,r){var n=b[r];t&&n&&e.push([n,t])}),e=angular.copy(e);var t={};y={},e.forEach(function(r){var n=t[r[0]]?t[r[1]]?!1:r[1]:r[0];if(n){var a=E(n,e,t);y[_.min(a,function(e){return 1*e.substring(1)})]=a}})}function u(e,t){v[e]=t}function p(e){h[e]=[],c()}function d(e){return"startpoint"===e?e:v[e]}function f(e,t){h[e].push(t),b[t]=e}function m(){return[h,b,v,S,y]}var g=-1,v={},h={},b={},S={},y={},w={};w.getConnections=m,w.addSubject=p,w.addMapping=u,w.getScopeID=d,w.addPropertyToSubject=f,w.generateID=a,w.remove=o,w.connect=l,w.updateConnectionLabel=n,w.getGroups=r;var E=function(e,t,r){function n(t){t[0]!==e||r[t[1]]?t[1]!==e||r[t[0]]||a.push(t[0]):a.push(t[1])}var a=[],i=[];for(a.push(e);a.length>0;)e=a.shift(),r[e]||(r[e]=!0,i.push(e),t.forEach(n));return i};return w}angular.module("GSB.connectionService",["GSB.arrowService"]).factory("connectionService",e),e.$inject=["$q","ArrowService"]}(),function(){"use strict";function e(e,t,r,n,a){var i={},o=new Jassa(Promise,$.ajax),s=o.sparql,l=o.service,c=o.sponate,u=new l.SparqlServiceHttp(n.baseURL,n.defaultGraphURIs);u=new l.SparqlServiceCache(u);var p=new c.StoreFacade(u,n.prefixes);i.runSponateMap=function(e){var t=e.name,r=["de","en",""],n=new s.BestLabelConfig(r),a=c.MappedConceptUtils.createMappedConceptBestLabel(n);e.template[0].rows[0]=_.mapValues(e.template[0].rows[0],function(e,t){return _.startsWith(t,"$")?{id:e,label:{$ref:{target:a,on:e,attr:"displayLabel"}}}:e}),p.addMap(e);var i=p[t].find().limit(100);return i.list()};var d=function(e){return null===e||void 0===e?e:e.replace(/^<+/,"").replace(/>+$/,"")};i.extractLabelFromURI=function(e){e=d(e);var t=e.lastIndexOf("#"),r=e.lastIndexOf("/");return e.substr(t>r?t+1:r+1)};var f=function(e,t,r){var n=!1;t.forEach(function(t){a.setItem(t.id,e+".$label",t.value),n=n||"default"===t.id}),n||a.setItem("default",e+".$label",i.extractLabelFromURI(e)),r.forEach(function(t){a.setItem(t.id,e+".$comment",t.value)})};i.getPropertyType=function(e){var t=_.find(n.propertyTypeByType,function(t,r){return new RegExp(r).test(e.$type)});return t?t:(t=_.find(n.propertyTypeByRange,function(t,r){return new RegExp(r).test(e.$range)}),t?t:"STANDARD_PROPERTY")},i.getAvailableClasses=function(e){p.hasOwnProperty("classes")||p.addMap({name:"classes",template:[{id:"?uri",$labels:[{id:"?label_loc",value:"?label"}],$comments:[{id:"?comment_loc",value:"?comment"}]}],from:n.endPointQueries.getAvailableClasses});var t=p.classes.find();return t.list().then(function(t){return t=_.pluck(t,"val"),e&&(t=_.filter(t,{id:d(e)})),t.forEach(function(e){e.uri=d(e.id),f(e.uri,e.$labels,e.$comments)}),t}).catch(function(e){r.error("Getting Classes:",e)})};var m=function(e,t,n){p.hasOwnProperty(n+e)||p.addMap({name:n+e,template:[{id:"?uri"}],from:t});var a=p[n+e].find();return a.list().then(function(e){return _.pluck(_.pluck(e,"val"),"id")}).catch(function(e){r.error("An error occurred: ",e)})};i.getSuperAndEqClasses=function(e){return m(d(e),n.endPointQueries.getSuperAndEqClasses.replace("%uri%",d(e)),"SuperAndEqClasses")},i.getSubAndEqClasses=function(e){return m(d(e),n.endPointQueries.getSubAndEqClasses.replace("%uri%",d(e)),"SubAndEqClasses")};var g=function(e,t,a,o){var s=a?"InverseProperties":"DirectProperties";p.hasOwnProperty(s+e)||p.addMap({name:s+e,template:[{id:"?uri",$labels:[{id:"?label_loc",value:"?label"}],$comments:[{id:"?comment_loc",value:"?comment"}],$range:[{id:"?range"}],$type:"?type"}],from:t});var l=p[s+e].find();return l.list().then(function(e){return e=_.pluck(e,"val"),o&&(e=_.filter(e,{id:d(o)})),a||(e=_.union([],e,n.defaultProperties,n.aggregateFunctions)),e.forEach(function(e){e.$range=_.pluck(e.$range,"id"),e.uri=d(e.id),f(e.uri,e.$labels,e.$comments),a?e.type="INVERSE_PROPERTY":e.type||(e.type=i.getPropertyType(e))}),e}).catch(function(e){r.error("An error occurred: ",e)})};return i.getDirectProperties=function(e,t){return g(d(e),n.endPointQueries.getDirectProperties.replace("%uri%",e),!1,t)},i.getInverseProperties=function(e,t){return g(d(e),n.endPointQueries.getInverseProperties.replace("%uri%",e),!0,t)},i.getPropertyDetails=function(e,t){return"INVERSE_PROPERTY"===t.type?i.getInverseProperties(d(e),t.uri):i.getDirectProperties(d(e),t.uri)},i.getPossibleRelations=function(e,t){var a=e+t;p.hasOwnProperty(a)||p.addMap({name:a,template:[{id:"?uri"}],from:n.endPointQueries.getPossibleRelation.replace("%uri1%",e).replace("%uri2%",t)});var i=p[a].find();return i.list().then(function(e){return e=_(e).pluck("val").pluck("id").value()}).catch(function(e){r.error("An error occurred: ",e)})},i}angular.module("GSB.endPointService",["GSB.config"]).factory("EndPointService",e),e.$inject=["$http","$q","$log","globalConfig","languageStorage"]}(),function(){"use strict";function e(e){function t(){if(null!==r){var t=e.defer();return t.resolve(r),t.promise}return e.when(jsPlumb.ready(function(){r=jsPlumb.getInstance({Endpoint:["Dot",{cssClass:"hidden"}],ConnectionOverlays:[["Arrow",{location:1,id:"arrow",cssClass:"arrow",length:14,foldback:.8}],["Label",{label:"",id:"label",cssClass:"connector-label"}]],Container:"workspace"}),r.bind("connection",function(e){var t=e.connection.getParameter("label");null===t?e.connection.removeOverlay("label"):e.connection.getOverlay("label").setLabel(t)})})).then(function(){return r})}var r=null;return{connectToSelf:function(e){return t().then(function(t){return t.connect({source:e,target:e,connector:["Bezier",{showLoopback:!1,curviness:50,proximityLimit:0}],cssClass:"connector",anchors:[[1,.25,1,0],[1,.75,1,0]],parameters:{label:null}})})},connect:function(e,r,n,a){return t().then(function(t){return t.connect(a?{source:r,target:e,cssClass:"connector",anchors:["Continuous",["Continuous",{faces:["left","right"]}]],connector:"Bezier",parameters:{label:n}}:{source:e,target:r,cssClass:"connector",anchors:[["Continuous",{faces:["left","right"]}],"Continuous"],connector:"Bezier",parameters:{label:n}})})},repaint:function(e){return t().then(function(t){return t.repaint(e)})},repaintEverything:function(){return t().then(function(e){return e.repaintEverything()})},detach:function(e){return t().then(function(t){return null!==e?t.detach(e):void 0})},setVisibilityForAllConnection:function(e){return t().then(function(t){angular.forEach(t.getAllConnections(),function(t){t.setVisible(e)})})},deleteAllConnections:function(e){return t().then(function(t){return null!==e&&t.removeAllEndpoints(e),t.repaintEverything()})},updateConnectionLabel:function(e,t){return null!==e?e.getOverlay("label").setLabel(t):void 0},resetService:function(){r=null}}}angular.module("GSB.arrowService",["GSB.config"]).factory("ArrowService",e),e.$inject=["$q"]}(),function(){"use strict";function e(e,t,r,n,a,i){n.get("locale.json").success(function(e){i.mergeLanguages(e),a.refresh()}),e.IntroOptions={steps:[{element:document.querySelector("sadnavigation"),intro:"<h1>Graphical SPARQL Builder Hilfe</h1><p>Der Graphical SPARQL Builder....</p><p>Zum Start der Tour, bitte auf weiter klicken.</p>",tooltipClass:"wide"},{intro:"<h2>Arbeitsfläche</h2><p>Im Hintergrund sehen Sie die Arbeitsfläche, das Kernstück des GSB.... </p>"},{element:"#navigation",intro:"<h2>Navigation</h2><p>Lorem IPSUM</p>",position:"right"},{element:"#step4",intro:"Another step.",position:"bottom"},{element:"#step5",intro:"Get it, use it."}],showBullets:!0,exitOnOverlayClick:!0,exitOnEsc:!0,showStepNumbers:!1,nextLabel:'Weiter <i class="fa fa-chevron-right"></i>',prevLabel:'<i class="fa fa-chevron-left"></i> Zurück',skipLabel:"Abbruch",doneLabel:"Fertig"},e.CompletedEvent=function(){},e.ExitEvent=function(){},e.ChangeEvent=function(e){"navigation"===e.id},e.saveJSON=function(){e.$broadcast("saveJsonEvent")},e.initializeWorkspace=function(){t.debug("Initialized Workspace"),e.translatedJSON="In the near future the translated JSON will be here.",e.translatedSPARQL="In the near future the translated SPARQL will be here."},e.initializeWorkspace()}angular.module("GSB.mainCtrl",["GSB.config","ngTable","angular-intro"]).controller("MainCtrl",e),e.$inject=["$scope","$log","globalConfig","$http","$translate","languageStorage"]}(),function(){"use strict";function e(e){return function(t){for(var r in e.prefixes)if(e.prefixes.hasOwnProperty(r)){var n=new RegExp("<?"+e.prefixes[r]+"(\\w+)>?","ig");t=t.replace(n,r+":$1")}return t}}function t(){return function(e){return e.replace(/<http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#type>/gi,"a").replace(/where\s+/gi,"WHERE \n").replace(/limit/gi,"LIMIT").replace(/ +\.\s+/gi," .\n").replace(/ +;\s+/gi," .\n").replace(/\{/gi,"\n{\n").replace(/}\s+/gi,"\n}\n").replace(/^\?/gim,"	?").replace(/^FILTER/gim,"	FILTER").replace(/^BIND/gim,"	BIND").replace(/select distinct\s+/gi,"SELECT DISTINCT \n")}}angular.module("GSB.filters",["GSB.config"]).filter("replaceURIsWithPrefixes",e).filter("beautifySPARQL",t),e.$inject=["globalConfig"]}(),function(){"use strict";angular.module("GSB.config",[]).constant("globalConfig",{name:"STANDARD_CONFIG",propertyTypeByType:{"http://www.w3.org/2002/07/owl#ObjectProperty":"OBJECT_PROPERTY"},propertyTypeByRange:{"http://gsb.leipert.io/ns/":"OBJECT_PROPERTY","http://xmlns.com/foaf/0.1/":"OBJECT_PROPERTY","http://www.w3.org/2001/XMLSchema#(integer|float|double|decimal|positiveInteger|nonNegativeInteger)":"NUMBER_PROPERTY","http://www.w3.org/2001/XMLSchema#(string|literal)":"STRING_PROPERTY","http://www.w3.org/2001/XMLSchema#date":"DATE_PROPERTY"},prefixes:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",foaf:"http://xmlns.com/foaf/0.1/",owl:"http://www.w3.org/2002/07/owl#",gsb:"http://gsb.leipert.io/ns/"},resultFormats:[{name:"HTML",format:"text/html"},{name:"editable Query",format:"text/html",qtxt:!0},{name:"XML",format:"application/sparql-results+xml"},{name:"JSON",format:"application/sparql-results+json"},{name:"CSV",format:"text/csv"},{name:"TSV",format:"text/tab-separated-values"},{name:"Excel",format:"application/vnd.ms-excel"},{name:"Turtle",format:"text/turtle"},{name:"RDF XML",format:"application/rdf+xml"},{name:"N-TRIPLE",format:"text/plain"},{name:"Javascript",format:"application/javascript"}],defaultProperties:[{id:"http://www.w3.org/2000/01/rdf-schema#label",$labels:[{id:"default",value:"Label"}],$comments:[{id:"default",value:"This is the label of this subject."}],type:"STRING_PROPERTY"},{id:"$$uri",$labels:[{id:"default",value:"uri"}],$comments:[{id:"default",value:"The uri of this subject."}],type:"STRING_PROPERTY"}],defaultGraphURIs:["http://xmlns.com/foaf/0.1/","http://gsb.leipert.io/ns/"],baseURL:"https://ssl.leipert.io/sparql",resultURL:"https://ssl.leipert.io/sparql?timeout=5000&debug=on",allowedLanguages:["*","de","en"],fallBackLanguages:["en"],aggregateFunctions:[{id:"$$count",$labels:[{id:"default",value:"Count property"}],$comments:[{id:"default",value:"Counts how often a subject has a certain property."}],operator:"COUNT(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:null},{id:"$$concat",$labels:[{id:"default",value:"Concat property"}],$comments:[{id:"default",value:"Concats all values of the same property URI."}],operator:'GROUP_CONCAT(%alias%,", ")',type:"AGGREGATE_PROPERTY",restrictTo:null},{id:"$$sum",$labels:[{id:"default",value:"Sum a property"}],$comments:[{id:"default",value:"Sums up all values a number property."}],operator:"SUM(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$avg",$labels:[{id:"default",value:"Average a property"}],$comments:[{id:"default",value:"Returns the average of a number property."}],operator:"AVG(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$min",$labels:[{id:"default",value:"Get minimum of a property"}],$comments:[{id:"default",value:"Returns the minimum of a number property."}],operator:"MIN(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$max",$labels:[{id:"default",value:"Get maximum of a property"}],$comments:[{id:"default",value:"Returns the maximum of a number property."}],operator:"MAX(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"}],endPointQueries:{getDirectProperties:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class .?uri rdfs:domain ?class .OPTIONAL { ?uri rdfs:range ?range }  .OPTIONAL { ?uri rdf:type ?type }  .OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc) } .FILTER ( !isBlank(?class) && !isBlank(?uri) && !isBlank(?range) ) ",getInverseProperties:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class .?uri rdfs:range ?class .OPTIONAL { ?uri rdfs:domain ?range }  .OPTIONAL { ?uri rdf:type ?type }  .OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc) } .FILTER ( !isBlank(?class) && !isBlank(?uri) && !isBlank(?range) ) ",getSuperAndEqClasses:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?uri FILTER ( !isBlank(?uri) )",getSubAndEqClasses:"<%uri%> (^rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?uri FILTER ( !isBlank(?uri) )",getAvailableClasses:"{?uri a rdfs:Class .} UNION {?uri a owl:Class .} .FILTER ( !isBlank(?uri) )OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc)} ",getPossibleRelation:"<%uri1%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class1 .<%uri2%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class2 .{ ?uri rdfs:domain ?class1 . ?uri rdfs:range ?class2  .} UNION { ?uri rdfs:domain ?class2 . ?uri rdfs:range ?class1  .}"}})}(),angular.module("GSB.config").config(["globalConfig",function(e){e.name="GSB_CONFIG"}]);