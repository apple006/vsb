!function(){"use strict";function e(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}function t(e,t,n){e.getItem("current").then(function(e){null!==e&&void 0!==e&&e.CONFIG===t.name&&n.translateJSONToVSBL(e)})}function n(e,t,n,a,r){function i(){if(!s){var n={VSBProtocol:t.location.protocol,EndpointProtocol:o.protocol,VSBLink:o.protocol+"//"+t.location.host+t.location.pathname+t.location.hash},a='<span translate="MIXED_CONTENT_WARNING" translate-values=\''+JSON.stringify(n)+"'></span>";e.addMessage({message:a,"class":"warning",icon:"exclamation-triangle"})}}var s=!1,o=document.createElement("a");o.href=r.baseURL,t.location.protocol!==o.protocol&&(n.get(r.baseURL+"?query=select+%3Fs+where+%7B%5B%5D+a+%3Fs%7D+LIMIT+1&format=json").success(function(){s=!0}),a(function(){},1e3).then(i))}angular.module("VSB",["VSB.message","VSB.config","VSB.layout","VSB.filters","VSB.subject","VSB.mainCtrl","VSB.language","pascalprecht.translate"]).run(n).run(t).config(e),e.$inject=["$compileProvider"],t.$inject=["$localForage","globalConfig","TranslatorToVSBL"],n.$inject=["MessageService","$window","$http","$timeout","globalConfig"]}(),angular.module("VSB").run(["$templateCache",function(e){e.put("/components/ui.select/choiceRowInner.tpl.html",'<div class=ui-select-choices-row-inner><div class=content ng-class="{\'has-comment\':item.$comment}"><p><span ng-bind-html="item.$label | highlightSearchTerm: $select.search"></span><b ng-if="item.type === \'INVERSE_PROPERTY\'" class=text-danger>&#x207b;&#x00b9;</b></p><p ng-bind-html="item.uri | replaceURIsWithPrefixes | highlightSearchTerm: $select.search"></p></div><div ng-if=item.$comment ng-class="{\'highlight\': $select.containsSearchTerm(item.$comment,$select.search)}" bs-popover data-trigger=hover data-type=success data-container=body data-placement=left data-html=true data-content="{{item.$comment| highlightSearchTerm: $select.search}}" class=fa-stack><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-info fa-stack-1x"></i></div></div>'),e.put("/components/ui.select/choices.tpl.html",'<ul class="ui-select-choices ui-select-choices-content dropdown-menu" ng-class="{\'no-divider\':($select.items.length === 0)}" role=listbox><li class=ui-select-choices-list ng-show="$select.items.length > 0"><div class=ui-select-choices-group id="ui-select-choices-{{ $select.generatedId }}"><div class=divider ng-show="$select.isGrouped && $index > 0"></div><div ng-show=$select.isGrouped class="ui-select-choices-group-label dropdown-header">{{$group.name | translate}}</div><div id="ui-select-choices-row-{{ $select.generatedId }}-{{$index}}" class=ui-select-choices-row ng-class="{active: $select.isActive(this), disabled: $select.isDisabled(this)}" role=option><a href=javascript:void(0) class=ui-select-choices-row-inner></a></div></div></li><li class=ui-select-footer><div class=divider ng-if="$select.items.length > 0"></div><div class=ui-select-footer-content><small ng-if="$select.items.length === 0" translate={{::footerZero}}></small><div ng-if=$select.items.length><small ng-if="$select.search.length === 0" translate={{::footerNoSearch}} translate-values="{ matching: $select.items.length, total: $select.totalItems }"></small> <small ng-if="$select.items.length.toString() !== $select.matchingItems && $select.search.length > 0" translate-values="{ x: $select.items.length, matching: $select.matchingItems, total: $select.totalItems }" translate="{{::footerFound+ \'_MORE\'}}"></small> <small ng-if="$select.items.length.toString() === $select.matchingItems && $select.search.length > 0" translate-values="{ matching: $select.matchingItems, total: $select.totalItems }" translate="{{::footerFound }}"></small></div></div></li></ul>'),e.put("/components/ui.select/match-multiple.tpl.html",'<span class=ui-select-match><span ng-repeat="$item in $select.selected"><span class="ui-select-match-item btn btn-default btn-xs" tabindex=-1 type=button ng-disabled=$select.disabled ng-click="$select.activeMatchIndex = $index;" ng-class="{\'btn-primary\':$select.activeMatchIndex === $index, \'select-locked\':$select.isLocked(this, $index)}" ui-select-sort=$select.selected><span class="close ui-select-match-close" ng-hide=$select.disabled ng-click=$select.removeChoice($index)>&nbsp;&times;</span> <span uis-transclude-append></span></span></span></span>'),e.put("/components/ui.select/match.tpl.html",'<div class=ui-select-match ng-hide=$select.open ng-disabled=$select.disabled ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex=-1 class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled=$select.disabled ng-click=$select.activate() style="outline: 0"><span ng-show=$select.isEmpty() class="ui-select-placeholder text-muted text-left">{{$select.placeholder}}</span> <span ng-hide=$select.isEmpty() class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click=$select.toggle($event)></i> <a ng-show="$select.allowClear && !$select.isEmpty()" aria-label="{{ $select.baseTitle }} clear" ng-click=$select.clear($event) class="btn btn-xs btn-link pull-right ui-select-clear"><i class="fa fa-trash-o" aria-hidden=true></i></a></span></div>'),e.put("/components/ui.select/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class=ui-select-match></div><input autocomplete=off autocorrect=off autocapitalize=off spellcheck=false class="ui-select-search input-xs" placeholder={{$select.getPlaceholder()}} ng-disabled=$select.disabled ng-hide=$select.disabled ng-click=$select.activate() ng-model=$select.search role=combobox aria-label="{{ $select.baseTitle }}" ondrop="return false"></div><div class=ui-select-choices></div></div>'),e.put("/components/ui.select/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class=ui-select-match></div><input autocomplete=off tabindex=-1 aria-expanded=true aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="form-control ui-select-search" placeholder={{$select.placeholder}} ng-model=$select.search ng-show="$select.searchEnabled && $select.open"><div class=ui-select-choices></div></div>'),e.put("/modules/result/content.tpl.html",'<div id=result><h3>{{ \'RESULTS\' | translate }}</h3><p>Format results as<select ng-model=currentFormat ng-options="format.name for format in resultFormats"></select>and <a href="" ng-click=openInNewTab()>show results!</a></p><div ng-show=showQueries class=col-sm-12><div class="col-sm-12 text-center"><a href="" ng-click="showQueries = false">{{ \'HIDE_QUERIES\' | translate }}</a></div><h3>{{ \'QUERIES\' | translate }}</h3><div class=col-sm-6><p>{{ \'JSON\' | translate }}:</p><pre id=json-query>{{translatedJSON | replaceURIsWithPrefixes}}</pre></div><div class=col-sm-6><p>{{ \'SPARQL\' | translate }}</p><pre id=sparql-query>{{translatedSPARQL}}</pre></div></div><div class="col-sm-12 text-center"><a href="" ng-show=showQueries ng-click="showQueries = false">{{ \'HIDE_QUERIES\' | translate }}</a> <a href="" ng-hide=showQueries ng-click="showQueries = true">{{ \'SHOW_QUERIES\' | translate }}</a></div></div>'),e.put("/modules/result/navigation.tpl.html",'<div class=list-group><a class=list-group-item ui-sref=workspace><i class="fa fa-fw fa-3x fa-backward"></i> <span class=list-group-item-description>{{ \'BACK_TO_WORKSPACE\' | translate }}</span></a> <a class=list-group-item ng-href="{{ blobURL }}" download=query.json target=_blank><i class="fa fa-fw fa-3x fa-download"></i> <span class=list-group-item-description>{{ \'DOWNLOAD_JSON\' | translate }}</span></a></div>'),e.put("/modules/workspace/content.tpl.html",'<div id=workspace><div ng-mousedown=vm.workspaceMouseDown($event) ng-mousemove=vm.workspaceMouseMove($event) ng-mouseup=vm.workspaceMouseUp() ng-class="{\'mouse-down\':vm.mouseDown}" class=bg-scroll></div><div messages></div><div class=startPointCSS id=startpoint><b>{{ \'LIST_ALL\' | translate }}</b><select ng-if="vm.groups.length > 1" ng-model=vm.mainSubject ng-change=vm.updateMainSubject() ng-options="s.alias for s in vm.groups | orderBy : \'alias\'" title="Main Subject Select" class=pull-right><option style=display:none value="">{{ \'PICK_MAIN_SUBJECT\' | translate }}</option></select></div><div class=connectNotification ng-if=vm.searchSubject><b>{{\'SEARCH_RELATION\' | translate:vm.searchSubject}}</b></div><div class="addSubjectBox form-group pull-right" ng-class={loading:vm.loading}><div ng-if=vm.loading class=loading><i class="fa fa-spinner fa-spin"></i> {{ \'CLASSES_LOADING\' | translate }}</div><div ng-if=!vm.loading><div ng-if="vm.totalItems === 0" class=loading><i class="fa fa-exclamation-triangle"></i> {{ \'NO_CLASSES_FOUND\' | translate }}</div><div class=input-group ng-if="vm.totalItems > 0"><ui-select ng-model=vm.selectedSubject append-to-body=true><ui-select-match allow-clear=true placeholder="{{ \'CHOOSE_A_SUBJECT\' | translate }}">{{$select.selected.$label}}</ui-select-match><ui-select-choices repeat="item.uri as item in vm.availableSubjectClasses" refresh="vm.refreshClasses($select.search, 50)" refresh-delay=0 total-items={{vm.totalItems}} matching-items={{vm.matchingItems}} footer-zero=CLASSES_FOUND_ZERO footer-no-search=CLASSES_FOUND_NO_SEARCH footer-found=CLASSES_FOUND_X><ui-select-choices-row-inner></ui-select-choices-row-inner></ui-select-choices></ui-select><span class=input-group-btn><button ng-click=vm.addSubject(vm.selectedSubject) class="btn btn-success"><span class="fa fa-plus"></span></button></span></div></div></div><subject-dir subject=subjectInst ng-repeat="subjectInst in vm.subjects track by subjectInst.$id"></subject-dir></div>'),e.put("/modules/workspace/navigation.tpl.html",'<div class=list-group><a class=list-group-item ng-click=vm.translate()><i class="fa fa-fw fa-3x fa-play-circle"></i> <span class=list-group-item-description>{{ \'RUN_QUERY\' | translate }}</span></a> <a id=reset class=list-group-item ng-click=vm.resetWorkspace()><i class="fa fa-fw fa-3x fa-undo"></i> <span class=list-group-item-description>{{ \'RESET_WORKSPACE\' | translate }}</span></a> <span class=list-group-item><i class="fa fa-fw fa-3x fa-upload"></i> <input type=file id=JSONReader name=JSONReader jsonreader> <span class=list-group-item-description>{{ \'LOAD_JSON\' | translate }}</span></span> <a class=list-group-item ng-click=CallMe(1)><i class="fa fa-fw fa-3x fa-question"></i> <span class=list-group-item-description>{{ \'HELP\' | translate }}</span></a> <a class=list-group-item ng-click=vm.print()><i class="fa fa-fw fa-3x fa-print"></i> <span class=list-group-item-description>{{ \'PRINT_PREVIEW\' | translate }}</span></a> <a class=list-group-item><i class="fa fa-fw fa-3x fa-language"></i> <span class=list-group-item-description><button ng-click="vm.changeLanguage(\'de\')" translate=BUTTON_LANG_DE class="btn btn-sm btn-primary"></button> <button ng-click="vm.changeLanguage(\'en\')" translate=BUTTON_LANG_EN class="btn btn-sm btn-primary"></button></span></a></div>'),e.put("/modules/workspace/modals/addAppropriateClass.tpl.html",'<div class=modal tabindex=-1 role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h1 class="modal-title h4">Possible {{property.alias}} of {{subject.alias}}:</h1><div class=input-group style="padding-top: 10px;width:100%"><input class=form-control placeholder="Filter available Classes" ng-model=search.$></div></div><div class=modal-body style="max-height: 350px; overflow-y: scroll"><h2 class=h5>{{subject.alias}} <i class="fa fa-fw" ng-class=arrowClass></i> {{property.alias}} <i class="fa fa-fw" ng-class=arrowClass></i> ???</h2><div class=list-group><a class=list-group-item ng-class="(selected === subject)?\'active\':\'\'" ng-repeat="subject in availableSubjects | filter : search" ng-click=select(subject)><popover-wrap ng-if=subject.$comment data-settings="{ class: \'fa fa-fw fa-info-circle pull-right\', content: subject.$comment }"></popover-wrap>{{ subject.$label }} <small>({{subject.uri | replaceURIsWithPrefixes}})</small></a></div></div><div class=modal-footer><div ng-if=selected class="pull-left text-left">Do you want to create the class:<br>{{subject.alias}} <i class="fa fa-fw" ng-class=arrowClass></i> {{property.alias}} <i class="fa fa-fw" ng-class=arrowClass></i> <b>{{selected.$label}}</b> ?</div><button class="btn btn-primary" ng-click=ok()>Create Class</button> <button class="btn btn-warning" ng-click=cancel()>Cancel</button></div></div></div></div>'),e.put("/modules/workspace/modals/castProperty.tpl.html",'<div class=modal tabindex=-1 role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h1 class="modal-title h4">Cast Type of {{property.alias}}</h1></div><div class=modal-body><h2 class=h5>Available types for casting:</h2><div class=list-group><a class=list-group-item ng-class="(selected === type)?\'active\':\'\'" ng-repeat="type in availableCasts" ng-click=select(type)>{{ type | translate }}</a></div><div ng-if=selected>Do you want to create to cast {{property.alias}} to {{selected | translate}}?</div></div><div class=modal-footer><button class="btn btn-primary" ng-click=ok()>Cast</button> <button class="btn btn-warning" ng-click=cancel()>Cancel</button></div></div></div></div>'),e.put("/modules/workspace/modals/findRelationModal.tpl.html",'<div class=modal tabindex=-1 role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h1 class="modal-title h4">Possible relations between {{subject1}} and {{subject2}}</h1><div class=input-group style="padding-top: 10px;width:100%"><input class=form-control placeholder="Filter available properties" ng-model=search.$></div></div><div class=modal-body style="max-height: 350px; overflow-y: scroll"><div ng-repeat="(idx,subject) in subjects track by $index" ng-if="(!dontShowSecond || idx === 0) && subject.$availableProperties.length > 0"><div class=list-group><h2 ng-if="idx === 0" class=h5>{{subject1}} -> ??? -> {{subject2}}</h2><h2 ng-if="idx === 1" class=h5>{{subject2}} -> ??? -> {{subject1}}</h2><a class=list-group-item ng-class="(selected === property && fromIDX === idx)?\'active\':\'\'" ng-repeat="property in subject.$availableProperties | filter : search" ng-click=select(property,idx)><popover-wrap ng-if=property.$comment data-settings="{ class: \'fa fa-fw fa-info-circle pull-right\', content: property.$comment }"></popover-wrap>{{ property.$label }} <small>({{property.uri | replaceURIsWithPrefixes}})</small></a></div></div></div><div class=modal-footer><div ng-if=selected class="pull-left text-left">Do you want to create the property:<br>{{subjects[fromIDX].alias}} -> <b>{{selected.$label }}</b> -> {{subjects[toIDX].alias}}?</div><button class="btn btn-primary" ng-click=ok()>Create Property</button> <button class="btn btn-warning" ng-click=cancel()>Cancel</button></div></div></div></div>'),e.put("/modules/workspace/property/property.tpl.html",'<div class=property-container ng-class="property.filterExists ? \'\' : \'notExists\'" id={{$id}}><div class=property-head><span class="pull-right icon-list"><i class="fa fa-square-o fa-fw" ng-if=!property.filterExists ng-click="vm.toggle(\'filterExists\')"></i> <i class="fa fa-fw fa-question-circle" ng-if="property.filterExists && property.optional" ng-click="vm.toggle(\'optional\')"></i> <i class="fa fa-fw fa-eye-slash" ng-if=!property.view ng-click="vm.toggle(\'view\')"></i><popover-wrap ng-if=property.$comment data-settings="{ class: \'fa fa-fw fa-info-circle hidden-print\', content: property.$comment }"></popover-wrap><i class="fa fa-fw fa-ellipsis-h hidden-print" data-container=body bs-dropdown=vm.dropdownConfig bs-model=property></i></span> <b><span class=h5><b>{{property.alias}} <span ng-if="property.type === \'INVERSE_PROPERTY\'" class=text-danger>&#x207b;&#x00b9;</span></b></span> <i class="fa fa-edit pointer hidden-print" ng-click="vm.editAlias = true"></i> <small><small>({{ ::property.uri | replaceURIsWithPrefixes}})</small></small></b><div class="input-group hidden-print" ng-show=vm.editAlias><input size=30 maxlength=40 class=form-control placeholder=Alias ng-model=property.alias><div class=input-group-btn><button class="btn btn-success" ng-click="vm.editAlias = false"><i class="fa fa-check-square-o"></i></button></div></div><div class=clearfix></div></div><div ng-if="property.filterExists && property.hasFilter" ng-switch on=property.type><div ng-switch-when=AGGREGATE_PROPERTY aggregate-property-dir property=property></div><div ng-switch-when=RELATION_PROPERTY object-property-dir property=property></div><div ng-switch-when=NUMBER_PROPERTY number-property-dir property=property></div><div ng-switch-when=STRING_PROPERTY string-property-dir property=property hide-language="property.uri === \'$$uri\'"></div><div ng-switch-when=STANDARD_PROPERTY string-property-dir property=property hide-language="property.uri === \'$$uri\'"></div><div ng-switch-when=INVERSE_PROPERTY object-property-dir property=property></div><div ng-switch-when=DATE_PROPERTY date-property-dir property=property></div><div ng-switch-default></div></div></div>'),e.put("/modules/workspace/propertyType/aggregate.tpl.html",'<div class=property-body><select ng-model=property.linkTo ng-options="x as x.alias for x in vm.availableProperties | aggregatePropertyFilter : property.restrictTo"><option value="">Choose a Property</option></select></div>'),e.put("/modules/workspace/propertyType/date.tpl.html",'<div class=property-body on-before-print="printed = true" on-after-print="printed = false"><div ng-if=!printed><div class="input-group input-group-sm"><div class="input-group-btn dropdown" is-open=status.isopen><button type=button class="btn btn-default dropdown-toggle" bs-dropdown=vm.dropdown>{{ vm.getDateComparisonLabel(vm.dateComparison) | translate}} <span class=caret></span></button></div><input class=form-control ng-model=vm.comparisonInput name=date data-date-format=yyyy-MM-dd bs-datepicker></div></div><small ng-if=printed>{{ vm.getDateComparisonLabel(vm.dateComparison) | translate}} "{{vm.comparisonInput | date:\'yyyy-MM-dd\' }}"</small></div>'),e.put("/modules/workspace/propertyType/number.tpl.html",'<div class=property-body on-before-print="printed = true" on-after-print="printed = false"><div ng-if=!printed><div class="input-group input-group-sm"><div class=input-group-addon>{{\'ARITHMETICS\' | translate}}</div><input class=form-control ng-model=vm.numberArithmetic limit-input="[^\\-\\*\\/\\.\\+()\\d xe]"></div><div class="input-group input-group-sm" style="margin-top: 5px"><div class=input-group-addon>{{\'COMPARISON\' | translate}}</div><input class=form-control ng-model=vm.numberComparison limit-input="[^\\-\\*\\/\\.\\+()><=!\\d xye]"></div></div><small ng-if=printed><span ng-if="vm.numberComparison !== \'y\'">If {{vm.numberComparison}}<br>with: y = {{vm.numberArithmetic | replace : {x: property.alias} }}</span> <span ng-if="vm.numberComparison === \'y\' && vm.numberArithmetic !== \'x\'">as: {{vm.numberArithmetic | replace : {x: property.alias} }}</span></small></div>'),e.put("/modules/workspace/propertyType/object.tpl.html",'<div on-before-print="printed = true" on-after-print="printed = false"><div ng-if=!printed class=property-body><div class="input-group input-group-sm" ng-show="vm.filtered.length > 0"><div class=input-group-addon>{{\'A_LINK_TO\' | translate}}</div><select ng-model=property.linkTo class="form-control input-sm" ng-options="x as x.alias for x in vm.filtered = (vm.subjects | objectPropertyFilter : \'$classURIs\' : property.$range)" title="Link with a subject"><option value="">{{\'LINK_WITH_SUBJECT\' | translate}}</option></select><div class=input-group-addon>{{\'EXISTS\' | translate}}</div></div><div ng-show="vm.filtered.length === 0"><div class="btn btn-sm btn-warning btn-block" ng-click=property.$addAppropriateClass()><i class="fa fa-fw fa-plug"></i> {{"ADD_APPROPRIATE_CLASS" | translate}}</div></div></div></div>'),e.put("/modules/workspace/propertyType/string.tpl.html",'<div class=property-body on-before-print="printed = true" on-after-print="printed = false"><div ng-if=!printed><div class="input-group input-group-sm"><div class=input-group-addon>{{\'COMPARISON\' | translate}}</div><div class="input-group-btn dropdown" is-open=dd2.isopen><button type=button class="btn btn-default" bs-dropdown=vm.dropdown style="border-radius: 0;border-right: 0">{{vm.getStringComparisonLabel() | translate}} <span class=caret></span></button></div><input ng-disabled="vm.stringComparison === null" class="form-control input-sm" ng-model=vm.comparisonInput> <span ng-show=vm.showFlags class=input-group-btn style=width:0></span> <input ng-show=vm.showFlags class="form-control input-sm" ng-model=vm.comparisonRegexFlags style="border-left:0"></div><div class="input-group input-group-sm" style="margin-top: 5px" ng-if=!hideLanguageFilter><div class=input-group-addon>{{\'LANGUAGE\' | translate}}</div><select ng-model=vm.selectedLanguage ng-options="x as x for x in vm.allowedLanguages" title="Select Language" class="form-control input-sm"><option value="">{{\'SELECT_LANGUAGE\' | translate}}</option></select></div></div><small ng-if=printed><span ng-if="vm.stringComparison !== null">{{ vm.getStringComparisonLabel(vm.stringComparison) | translate}} "{{vm.comparisonInput }}" <span ng-if=vm.selectedLanguage>&</span></span> <span ng-if=vm.selectedLanguage>is in the language"{{vm.selectedLanguage }}"</span></small></div>'),e.put("/modules/workspace/subject/popoverWrap.tpl.html",'<span><i class=hide-while-dragging ng-class="settings.class + \' \' + conditionalClass" ng-click=click() data-trigger=hover data-type=success data-container=body data-html=true data-content=" {{settings.content | translate}}" bs-popover></i> <i class=show-while-dragging ng-class="settings.class + \' \' + conditionalClass"></i></span>'),e.put("/modules/workspace/subject/subject.tpl.html",'<div class=subject-container id="{{ ::$id }}"><div class=subject-head><p><span class="pull-right icon-list"><span class=mover><i class="fa fa-fw fa-arrows"></i></span><popover-wrap ng-if=subject.$comment data-settings="{ class: \'fa fa-fw fa-info-circle hidden-print\', content: subject.$comment }"></popover-wrap><popover-wrap data-click="subject.view = !subject.view" data-settings="{ class: \'fa fa-fw\', content: (subject.view)?\'HIDE_SUBJECT\':\'SHOW_SUBJECT\' }" data-conditional-class="{{(subject.view)?\'fa-eye hidden-print\':\'fa-eye-slash\' }}"></popover-wrap><popover-wrap data-click=vm.searchRelation() data-settings="{ class: \'fa fa-fw fa-plug hidden-print\', content: \'CONNECT_SUBJECT\' }" data-conditional-class="{{(subject.$searchRelation)?\'text-info\':\'\' }}"></popover-wrap><popover-wrap data-click=vm.removeSubject() data-settings="{ class: \'fa fa-fw fa-trash-o hidden-print\', content: \'DELETE_SUBJECT\' }"></popover-wrap></span> <b><span class=h4>{{subject.alias}}</span> <i class="fa fa-edit pointer hidden-print" ng-click="vm.editAlias = !vm.editAlias"></i> <small><small>({{ ::subject.uri | replaceURIsWithPrefixes}})</small></small></b></p><div class="input-group pull-left hidden-print" ng-show=vm.editAlias><input size=30 maxlength=40 class=form-control placeholder=Alias ng-model=subject.alias> <span class="btn input-group-addon btn-success" ng-click="vm.editAlias = false"><i class="fa fa-check-square-o"></i></span></div><div class=clearfix></div></div><div class=subjectBody><property-dir property=property ng-repeat="property in subject.$selectedProperties track by property.$id"></property-dir></div><div class=subject-footer><div ng-if=!vm.showAddProperty class="text-center hidden-print"><div class="btn btn-sm btn-success" ng-click="vm.showAddProperty = true"><span class="fa fa-plus"></span> {{\'PROPERTY\' | translate }}</div></div><div ng-if=vm.showAddProperty class=hidden-print><div ng-if=vm.loading class="btn btn-success btn-sm"><i class="fa fa-spinner fa-spin"></i> {{ \'PROPERTIES_LOADING\' | translate }}</div><div ng-if=!vm.loading><div ng-if="vm.totalItems === 0" class="btn btn-success btn-sm"><i class="fa fa-exclamation-triangle"></i> {{ \'NO_PROPERTIES_FOUND\' | translate }}</div><div class=input-group ng-if="vm.totalItems > 0"><ui-select ng-model=vm.propertySelected append-to-body=true><ui-select-match allow-clear=true placeholder="{{ \'CHOOSE_A_PROPERTY\' | translate }}">{{$select.selected.$label}}</ui-select-match><ui-select-choices repeat="item in vm.$availableProperties" group-by="\'type\'" refresh=vm.refreshProperties($select.search,50) refresh-delay=0 total-items={{vm.totalItems}} matching-items={{vm.matchingItems}} footer-zero=PROPERTIES_FOUND_ZERO footer-no-search=PROPERTIES_FOUND_NO_SEARCH footer-found=PROPERTIES_FOUND_X><ui-select-choices-row-inner></ui-select-choices-row-inner></ui-select-choices></ui-select><span class=input-group-btn><button ng-click=vm.addProperty() class="btn btn-success"><span class="fa fa-plus"></span></button></span></div></div></div></div></div>'),e.put("/bower_components/angular-strap/src/alert/alert.tpl.html","<div class=alert ng-class=\"[type ? 'alert-' + type : null]\"><button type=button class=close ng-if=dismissable ng-click=$hide()>&times;</button> <strong ng-bind=title></strong>&nbsp;<span ng-bind-html=content></span></div>"),e.put("/bower_components/angular-strap/src/aside/aside.tpl.html",'<div class=aside tabindex=-1 role=dialog><div class=aside-dialog><div class=aside-content><div class=aside-header ng-show=title><button type=button class=close ng-click=$hide()>&times;</button><h4 class=aside-title ng-bind=title></h4></div><div class=aside-body ng-bind=content></div><div class=aside-footer><button type=button class="btn btn-default" ng-click=$hide()>Close</button></div></div></div></div>'),e.put("/bower_components/angular-strap/src/datepicker/datepicker.tpl.html",'<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px"><table style="table-layout: fixed; height: 100%; width: 100%"><thead><tr class=text-center><th><button tabindex=-1 type=button class="btn btn-default pull-left" ng-click=$selectPane(-1)><i class={{$iconLeft}}></i></button></th><th colspan="{{ rows[0].length - 2 }}"><button tabindex=-1 type=button class="btn btn-default btn-block text-strong" ng-click=$toggleMode()><strong style="text-transform: capitalize" ng-bind=title></strong></button></th><th><button tabindex=-1 type=button class="btn btn-default pull-right" ng-click=$selectPane(+1)><i class={{$iconRight}}></i></button></th></tr><tr ng-show=showLabels ng-bind-html=labels></tr></thead><tbody><tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%"><td class=text-center ng-repeat="(j, el) in row"><button tabindex=-1 type=button class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click=$select(el.date) ng-disabled=el.disabled><span ng-class="{\'text-muted\': el.muted}" ng-bind=el.label></span></button></td></tr></tbody></table></div>'),e.put("/bower_components/angular-strap/src/dropdown/dropdown.tpl.html",'<ul tabindex=-1 class=dropdown-menu role=menu><li role=presentation ng-class="{divider: item.divider}" ng-repeat="item in content"><a role=menuitem tabindex=-1 ng-href={{item.href}} ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind=item.text></a> <a role=menuitem tabindex=-1 href=javascript:void(0) ng-if="!item.divider && item.click" ng-click=$eval(item.click);$hide() ng-bind=item.text></a></li></ul>'),e.put("/bower_components/angular-strap/src/modal/modal.tpl.html",'<div class=modal tabindex=-1 role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header ng-show=title><button type=button class=close ng-click=$hide()>&times;</button><h4 class=modal-title ng-bind=title></h4></div><div class=modal-body ng-bind=content></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=$hide()>Close</button></div></div></div></div>'),e.put("/bower_components/angular-strap/src/popover/popover.tpl.html","<div class=popover><div class=arrow></div><h3 class=popover-title ng-bind=title ng-show=title></h3><div class=popover-content ng-bind=content></div></div>"),e.put("/bower_components/angular-strap/src/select/select.tpl.html",'<ul tabindex=-1 class="select dropdown-menu" ng-show=$isVisible() role=select><li ng-if=$showAllNoneButtons><div class=btn-group style="margin-bottom: 5px; margin-left: 5px"><button type=button class="btn btn-default btn-xs" ng-click=$selectAll()>{{$allText}}</button> <button type=button class="btn btn-default btn-xs" ng-click=$selectNone()>{{$noneText}}</button></div></li><li role=presentation ng-repeat="match in $matches" ng-class="{active: $isActive($index)}"><a style="cursor: default" role=menuitem tabindex=-1 ng-click="$select($index, $event)"><i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i> <span ng-bind=match.label></span></a></li></ul>'),e.put("/bower_components/angular-strap/src/tab/tab.tpl.html",'<ul class=nav ng-class=$navClass role=tablist><li ng-repeat="$pane in $panes track by $index" ng-class="$index == $panes.$active ? $activeClass : \'\'"><a role=tab data-toggle=tab ng-click=$setActive($index) data-index="{{ $index }}" ng-bind-html=$pane.title></a></li></ul><div ng-transclude class=tab-content></div>'),e.put("/bower_components/angular-strap/src/timepicker/timepicker.tpl.html",'<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto"><table height=100%><thead><tr class=text-center><th><button tabindex=-1 type=button class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)"><i class="{{ $iconUp }}"></i></button></th><th>&nbsp;</th><th><button tabindex=-1 type=button class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)"><i class="{{ $iconUp }}"></i></button></th></tr></thead><tbody><tr ng-repeat="(i, row) in rows"><td class=text-center><button tabindex=-1 style="width: 100%" type=button class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled=row[0].disabled><span ng-class="{\'text-muted\': row[0].muted}" ng-bind=row[0].label></span></button></td><td><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td class=text-center><button tabindex=-1 ng-if=row[1].date style="width: 100%" type=button class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled=row[1].disabled><span ng-class="{\'text-muted\': row[1].muted}" ng-bind=row[1].label></span></button></td><td ng-if=showAM>&nbsp;</td><td ng-if=showAM><button tabindex=-1 ng-show="i == midIndex - !isAM * 1" style="width: 100%" type=button ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click=$switchMeridian() ng-disabled=el.disabled>AM</button> <button tabindex=-1 ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type=button ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click=$switchMeridian() ng-disabled=el.disabled>PM</button></td></tr></tbody><tfoot><tr class=text-center><th><button tabindex=-1 type=button class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)"><i class="{{ $iconDown }}"></i></button></th><th>&nbsp;</th><th><button tabindex=-1 type=button class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)"><i class="{{ $iconDown }}"></i></button></th></tr></tfoot></table></div>'),e.put("/bower_components/angular-strap/src/tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show=title><div class=tooltip-arrow></div><div class=tooltip-inner ng-bind=title></div></div>'),e.put("/bower_components/angular-strap/src/typeahead/typeahead.tpl.html",'<ul tabindex=-1 class="typeahead dropdown-menu" ng-show=$isVisible() role=select><li role=presentation ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}"><a role=menuitem tabindex=-1 ng-click="$select($index, $event)" ng-bind=match.label></a></li></ul>'),e.put("/components/angular-strap-patches/src/dropdown/dropdown.tpl.html",'<ul tabindex=-1 class=dropdown-menu role=menu ng-controller="DropdownCtrl as vm"><li role=presentation ng-repeat="item in content" ng-class="{divider: item.divider}" ng-click=vm.execute(item) ng-hide=vm.hide(item) ng-show=vm.show(item)><a ng-if=item.template compile=item.template></a> <a ng-if="item.templateArray && !vm.model[item.field]" compile=item.templateArray[0]></a> <a ng-if="item.templateArray && vm.model[item.field]" compile=item.templateArray[1]></a></li></ul>')
}]),function(){"use strict";angular.module("zenubu.ngStrap.modal",["mgcrea.ngStrap.modal","ngSanitize"]).config(["$modalProvider",function(e){angular.extend(e.defaults,{html:!0})}]).config(["$provide",function(e){e.decorator("$modal",["$controller","$delegate","$injector","$q","$rootScope",function(e,t,n,a,r){function i(e){o=a.defer();var n=t(e);n.dismiss=function(e){o.reject(e)};var r=n.hide;return n.hide=function(){r(),n.destroy()},n.close=function(e){o.resolve(e)},n.result=o.promise.then(function(e){return n.hide(),e})["catch"](function(e){return n.hide(),a.reject(e)}),n}function s(t){var s,l,c=[],u=_.omit(t,["controller","controllerAs","resolve"]),p=u.scope||r;return t.resolve&&(c=_.map(t.resolve,function(e){return n.invoke(e)})),t.controller&&(l=a.all(c).then(function(n){var a={},r=0;_.forEach(t.resolve,function(e,t){a[t]=n[r++]}),p=p.$new(),a.$scope=p,a.$modalInstance={},a.$modalInstance.dismiss=function(e){o.reject(e)},a.$modalInstance.close=function(e){o.resolve(e)},s=e(t.controller,a),t.controllerAs&&(p[t.controllerAs]=s)})),l.then(function(){return _.assign(u,{scope:p}),i(u)})}var o;return i.open=s,i}])}])}(),function(){"use strict";function e(e){return function(t,n,a){t.$watch(function(e){return e.$eval(a.compile)},function(a){n.html(a),e(n.contents())(t)})}}function t(e){e.decorator("bsDropdownDirective",["$delegate",function(e){var t=e[0],n=t.link,a=function(e,t,a,r){n(e,t,a,r),e.$watchCollection(a.bsModel,function(t){e.bsModel=t},!0)};return t.compile=function(){return a},e}])}function n(e){function t(e){"function"==typeof e.click&&e.click(r.model,e.field)}function n(e){return"function"==typeof e.hide?e.hide(r.model,e.field):e.hasOwnProperty("hide")?r.model[e.field]===e.hide:!1}function a(e){return"function"==typeof e.show?e.show(r.model,e.field):e.hasOwnProperty("show")?r.model[e.show]===e.show:!0}var r=this;r.model=e.bsModel,r.execute=t,r.hide=n,r.show=a}angular.module("zenubu.ngStrap.dropdown",["mgcrea.ngStrap.dropdown","ngSanitize"]).config(["$dropdownProvider",function(e){angular.extend(e.defaults,{html:!0,placement:"bottom",template:"/components/angular-strap-patches/src/dropdown/dropdown.tpl.html",container:"body"})}]).controller("DropdownCtrl",n).config(t).directive("compile",e),e.$inject=["$compile"],t.$inject=["$provide"],n.$inject=["$scope"]}(),function(){"use strict";function e(e){angular.extend(e.defaults,{iconLeft:"fa fa-fw fa-chevron-left",iconRight:"fa fa-fw fa-chevron-right"}),angular.extend(e.defaults,n())}function t(e){e.decorator("$dateFormatter",["$delegate",function(e){var t=e;t.getDefaultLocale=function(){return moment.locale()},t.weekdaysShort=function(){return moment.weekdaysShort()};var a=t.formatDate;return t.formatDate=function(e,t,r){return _.contains(n(),t)?moment(e.toISOString()).format(t):a(e,t,r)},t}])}function n(){return{dayFormat:"DD",monthTitleFormat:"MMMM YYYY",monthFormat:"MMM",yearFormat:"YYYY",yearTitleFormat:"YYYY"}}angular.module("zenubu.ngStrap.datepicker",["mgcrea.ngStrap.datepicker","mgcrea.ngStrap.helpers.dateFormatter"]).config(t).config(e),e.$inject=["$datepickerProvider"],t.$inject=["$provide"]}(),function(){"use strict";function e(e,a,r,i){return{restrict:"E",replace:!0,scope:{subject:"="},controller:t,controllerAs:"vm",templateUrl:"/modules/workspace/subject/subject.tpl.html",link:n(e,a,r,i)}}function t(e,t,n,a){function r(){o.addProperty(l.propertySelected),l.propertySelected=void 0,l.showAddProperty=!1}function i(){n.removeSubject(o.$id)}function s(){o.$searchRelation=!0,n.searchRelation(o)}var o=e.subject,l=this;l.editAlias=!1,l.comment=o.uri+".$comment",l.removeSubject=i,l.addProperty=r,l.searchRelation=s,l.$availableProperties=[],l.loading=!0,t.when(o.$loading).then(function(){l.loading=!1,l.refreshProperties("",50)}),a.$on("translateEverything",function(){l.showAddProperty&&l.refreshProperties("",50)}),l.refreshProperties=function(e,t){return o.getAvailableProperties(e,t).then(function(e){var t=_.xor(_.pluck(e.items,"uri"),_.pluck(l.$availableProperties,"uri"));t.length>0&&(l.$availableProperties=e.items,l.totalItems=e.total,l.matchingItems=e.matching)})}}function n(e,t,n,a){return function(r,i){var s=angular.copy(r.subject.pos),o=s.x||150,l=s.y||250;i.css({left:o+"px",top:l+"px"}),a.$on("moveSubjectDrag",function(e,t,n){o+=t.x,l+=t.y,i.css({left:o+"px",top:l+"px"}),n&&(r.subject.pos.x=angular.copy(o),r.subject.pos.y=angular.copy(l))}),a.$on("moveSubjectEnd",function(){r.subject.pos.x=angular.copy(o),r.subject.pos.y=angular.copy(l)}),n.registerSubject(r.$id,i),e.makeDraggable(i,{containment:"parent",handle:".mover",start:function(){r.$evalAsync(function(){n.increaseIndex(r.$id),r.vm.showAddProperty=!1,t.recalculateOffsets(r.subject.$id)})},drag:function(){t.recalculateOffsets(r.subject.$id,!0)},stop:function(e,t){o=angular.copy(t.position.left),l=angular.copy(t.position.top),r.$evalAsync(function(){r.subject.pos.x=angular.copy(o),r.subject.pos.y=angular.copy(l)})}}),t.addMapping(r.subject.$id,r.$id)}}angular.module("VSB.subject.instance",["VSB.config","VSB.endPointService","VSB.arrowService","VSB.filters"]).directive("subjectDir",e),e.$inject=["ArrowService","connectionService","zIndexService","$rootScope"],t.$inject=["$scope","$q","SubjectService","$rootScope"]}(),function(){"use strict";angular.module("VSB.subject",["VSB.subject.model","VSB.subject.service","VSB.subject.instance","VSB.property"])}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,require:"?^ngClick",scope:{settings:"=",click:"&",conditionalClass:"@"},templateUrl:"/modules/workspace/subject/popoverWrap.tpl.html"}}function t(e,t,n,a,r,i,s,o,l,c,u){function p(){return A}function d(e){if(_.isObject(e))if(A.push(e),1===A.length){u.dismiss(I);var t={alias:'"'+A[0].alias+'"'};I=u.addMessage({message:"<span translate='SEARCH_RELATION' translate-values='"+JSON.stringify(t)+"'></span>","class":"info",dismiss:f,icon:"info-circle"})}else o.open({template:"/modules/workspace/modals/findRelationModal.tpl.html",controller:"findRelationModalCtrl",controllerAs:"foo",resolve:{subjects:function(){return A},possibleRelations:["EndPointService",function(e){return e.getPossibleRelations(A[0].uri,A[1].uri)}]}}).then(function(e){return e.result}).then(f,f)}function f(){_.forEach(A,function(e){e.$searchRelation=!1}),A=[],I=u.dismiss(I,!0)}function m(){var e=n.getGroups(!0),t=_.isEmpty(C.mainSubject)?null:angular.copy(C.mainSubject.$id),a=_.keys(e),r=C.groups;C.groups=_.filter(C.subjects,function(e){return _.contains(a,e.$id)});var i=null;if(null!==t&&!_.contains(a,t)){var s=_.findKey(e,function(e){return _.contains(e,t)});i=_.find(C.groups,{$id:s})}1===C.groups.length&&(i=C.groups[0]),_.isObject(i)&&i.$id!==t&&C.redrawMainConnection(i),_.xor(r,C.groups).length>0&&c.$emit("availableGroupsChanged")}function g(e){var t=_.where(C.subjects,{alias:e.linkTo});t.length>0&&(e.linkTo=t[0])}function v(e){var t=_.where(C.subjects,{alias:e})[0];C.redrawMainConnection(t)}function h(){return C.mainSubject}function b(){return C.subjects}function S(e,t){return l.getFromCache("availableClasses").then(function(n){return a.filterByTokenStringWithLimit(n,e,t)})}function y(e){var t={uri:e,$classURIs:[e]};return w(t)}function w(n){t.debug("SUBJECT added "+n.uri,n),n.pos=n.pos?n.pos:T(),n.alias=R(n.alias,n.$label,n.uri);var a=new e(n);return C.subjects.push(a),m(),a}function $(e){return n.remove(e).then(function(){_.remove(C.subjects,{$id:e}),0===C.subjects.length&&E()})}function E(){var e=[];return C.subjects.forEach(function(t){e.push($(t.$id).then(function(){l.removeFromCache(t.$id)}))}),i.all(e).then(function(){C.mainSubject=null,C.groups=[],t.debug("Workspace reset")})}function R(e,t,n){e||(e=t),e||(e=s.instant(n+".$label")),e=_.trunc(e,35);for(var a=e,r=1;!P(a);)a=e+" "+r,r+=1;return a}function P(e){return 0===_.filter(C.subjects,{alias:e}).length}function T(){var e=150+40*x;return x=(x+1)%5,{x:e+j,y:e}}var C={};C.subjects=[],C.mainSubject=null,C.groups=[];var A=[];C.addSubjectByURI=y,C.addSubject=w,C.removeSubject=$,C.isAliasUnique=P,C.reset=E,C.getAvailableClasses=S,C.getMainSubject=h,C.getSubjects=b,C.getSearchRelationSubjects=p,C.getSubjectById=function(e){return _.where(C.subjects,{$id:e})[0]},C.setMainSubjectWithAlias=v,C.linkSubjectWithProperty=g,C.refreshGroups=m;var O=null;C.redrawMainConnection=function(e){if(_.isObject(e)){var t=n.connect("startpoint",e.$id,"Start").then(function(){O=null,C.mainSubject=e,c.$emit("mainSubjectChanged")});null===O?O=t:O.cancel().then(function(){return t})}},C.searchRelation=d;var I;c.$on("connectionGroupsChanged",m),C.loading=r.getAvailableClasses()["catch"](function(e){t.error("An error occurred while loading available Classes: ",e);var n="<span> An error occured while loading available classes <br>"+_.escape(e)+"</span>";u.addMessage({message:n,icon:"times-circle-o","class":"danger"})}).then(function(e){if(t.debug("Classes loaded ",e),0===e.length){var n="<span>Your endpoint returned zero classes</span>";u.addMessage({message:n,icon:"times-circle-o","class":"danger"})}return l.putInCache("availableClasses","class",e)}).then(function(){C.loading=!1});var x=0,j=0;return c.$on("mainOffset",function(e,t){j=t?200:0}),C}angular.module("VSB.subject.service",["VSB.endPointService","VSB.language","VSB.subject.model","VSB.arrowService"]).factory("SubjectService",t).directive("popoverWrap",e),t.$inject=["Subject","$log","connectionService","helperFunctions","EndPointService","$q","$translate","$modal","translationCacheService","$rootScope","MessageService"]}(),function(){"use strict";function e(e,t,n,a,r,i,s,o,l,c){return function(u){function p(e){e.$subject={uri:v.uri,$id:v.$id},e.alias=d(e.alias,e.$label,e.uri);var t=new i(e);return v.$selectedProperties.push(t),s.recalculateOffsets(v.$id),t}function d(e,t,a){e||(e=t),e||(e=n.instant(a+".$label")),e=_.trunc(e,35);for(var r=e,i=1;!f(r);)r=e+" "+i,i+=1;return r}function f(e){return 0===_.filter(v.$selectedProperties,{alias:e}).length}function m(e){s.remove(e).then(function(){_.remove(v.$selectedProperties,{$id:e})})}function g(e,t){var n={pre:function(e,t){if(!_.isArray(e)||!_.isString(t)||_.isEmpty(t))return{};var n=_(e).pluck("type").uniq().map(function(e){return e.toLowerCase().replace("_property","")}).value(),a=new RegExp(":("+_.map(n,_.escapeRegExp).join("|")+")(?=\\s+|$)","ig");if(!t.match(a))return{};var r=_.words(t,a)[0].toUpperCase().replace(":","")+"_PROPERTY";return{array:_.where(e,{type:r}),filter:t.replace(a,"")}}};return o.getFromCache(v.$id).then(function(r){return a.filterByTokenStringWithLimit(r,e,t,n)})}var v={uri:null,pos:{},view:!0,$classURIs:[],$id:null,$selectedProperties:[]};_.extend(v,u),v.$id=s.generateID(),s.addSubject(v.$id),v.getAvailableProperties=g,v.addProperty=p,v.removeProperty=m,e.getSuperAndEqClasses(v.uri).then(function(e){t.debug("SUBJECT Additional Classes loaded for "+v.uri,e),v.$classURIs=e})["catch"](function(e){t.error(e)});var h=e.getDirectProperties(v.uri)["catch"](function(e){var n="<span> An error occured while loading direct properties for "+v.uri+"<br>"+_.escape(e)+"</span>";return l.addMessage({message:n,icon:"times-circle-o","class":"danger"}),t.error("PROPERTIES (direct) loaded for "+v.uri,"An error occurred: ",e),[]}),b=e.getInverseProperties(v.uri)["catch"](function(e){var n="<span> An error occured while loading indirect properties for "+v.uri+"<br>"+_.escape(e)+"</span>";return l.addMessage({message:n,icon:"times-circle-o","class":"danger"}),t.error("An error occurred: ",e),[]});v.$loading=r.all([h,b]).then(function(e){e=_.flatten(e),o.putInCache(v.$id,"property",e)});var S=null;return c.$on("$translateChangeSuccess",function(e,t){if(!v.$label||S!==t.language){var a=v.uri+".$comment",r=v.uri+".$label";n([a,r]).then(function(e){r!==e[r]&&(S=t.language,v.$label=e[r],v.$comment=a!==e[a]?e[a]:!1)})}}),v}}angular.module("VSB.subject.model",["VSB.endPointService","pascalprecht.translate","VSB.connectionService"]).factory("Subject",e),e.$inject=["EndPointService","$log","$translate","helperFunctions","$q","Property","connectionService","translationCacheService","MessageService","$rootScope"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"=",hideLanguageFilter:"=hideLanguage"},templateUrl:"/modules/workspace/propertyType/string.tpl.html"}}function t(e,t){function n(e,t,n){return null===t||void 0===t||""===t||void 0===e||null===e?(r.compare=null,void a()):(r.compare=i.allowedStringComparisons[e].f.replace(/%input%/,t).replace(/%flags%/,n),void a())}function a(){r.compareRaw.selectedLanguage=i.selectedLanguage,null!==i.selectedLanguage&&void 0!==i.selectedLanguage&&""!==i.selectedLanguage&&(r.compare=null===r.compare||void 0===r.compare?'langMatches(lang(%after_arithmetic%), "'+i.selectedLanguage+'")':'langMatches(lang(%after_arithmetic%), "'+i.selectedLanguage+'") && '+r.compare)}var r=e.property,i=this,s=angular.copy(r.compareRaw);i.allowedStringComparisons=[{label:"CONTAINS",f:'regex(%after_arithmetic%, "%input%", "i")',showFlags:!1},{label:"EQUALS",f:'(str(%after_arithmetic%)="%input%")',showFlags:!1},{label:"EQUALS_NOT",f:'(str(%after_arithmetic%)!="%input%")',showFlags:!1},{label:"STARTS_WITH",f:'regex(%after_arithmetic%, "^%input%", "i")',showFlags:!1},{label:"ENDS_WITH",f:'regex(%after_arithmetic%, "%input%$", "i")',showFlags:!1},{label:"REGEX",f:'regex(%after_arithmetic%, "%input%", "%flags%")',showFlags:!0}],i.dropdown=_.map(i.allowedStringComparisons,function(e,t){return{click:function(){i.changeStringComparison(t)},template:'{{ "'+e.label+'" | translate}}'}}),i.dropdown.unshift({click:function(){i.changeStringComparison(null)},template:'{{ "NO_COMPARISON" | translate }}'}),i.allowedLanguages=t.allowedLanguages,i.stringComparison=null,i.comparisonInput="",i.comparisonRegexFlags="i",i.selectedLanguage=null,i.getStringComparisonLabel=function(){return null===i.stringComparison?"NO_COMPARISON":i.allowedStringComparisons[i.stringComparison].label},i.changeStringComparison=function(e){i.stringComparison=e},null!==s&&void 0!==s&&(null!==s.selectedLanguage&&void 0!==s.selectedLanguage&&(i.selectedLanguage=s.selectedLanguage),null!==s.stringComparison&&void 0!==s.stringComparison&&(i.stringComparison=s.stringComparison),null!==s.comparisonInput&&void 0!==s.comparisonInput&&(i.comparisonInput=s.comparisonInput),null!==s.comparisonRegexFlags&&void 0!==s.comparisonRegexFlags&&(i.comparisonRegexFlags=s.comparisonRegexFlags)),e.$watch("vm.stringComparison",function(e){n(e,i.comparisonInput,i.comparisonRegexFlags),r.compareRaw.stringComparison=e,null!==e&&(i.showFlags=i.allowedStringComparisons[e].showFlags)}),e.$watch("vm.comparisonInput",function(e){r.compareRaw.comparisonInput=e,n(i.stringComparison,e,i.comparisonRegexFlags)}),e.$watch("vm.comparisonRegexFlags",function(e){r.compareRaw.comparisonRegexFlags=e,n(i.stringComparison,i.comparisonInput,e)}),e.$watch("vm.selectedLanguage",function(){a()})}angular.module("VSB.propertyType.string",["VSB.config"]).directive("stringPropertyDir",e),t.$inject=["$scope","globalConfig"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{property:"="},controllerAs:"vm",controller:t,templateUrl:"/modules/workspace/propertyType/object.tpl.html"}}function t(e,t,n){function a(e){r=e}var r=null,i=this,s=e.property,o="INVERSE_PROPERTY"===s.type;i.subjects=t.subjects;var l=angular.copy(s.$id);n.registerDestroyWatcher(s.$id,function(e){s.linkTo.$id.toString()===e.toString()&&(s.linkTo=void 0)}),e.$watch("property.alias",function(e){o&&(e=angular.copy(e)+"⁻¹"),n.updateConnectionLabel(r,e)}),e.$watch("property.linkTo",function(e){if(void 0!==e&&null!==e){var t=angular.copy(e.$id),r=o?s.alias+"⁻¹":s.alias;n.connect(l,t,r).then(a)}else n.disconnect(l),a(null)}),e.$on("$destroy",function(){n.disconnect(l),a(null)})}function n(){return function(e,t,n){return null===t||void 0===t||"object"!=typeof n||0===n.length?e:e.filter(function(e){if(void 0===e[this.key])return!0;for(var t=0,n=this.filter.length;n>t;t++)if(-1!==e[this.key].indexOf(this.filter[t]))return!0;return!1},{key:t,filter:n})}}angular.module("VSB.propertyType.object",["VSB.arrowService","VSB.connectionService"]).directive("objectPropertyDir",e).filter("objectPropertyFilter",n),t.$inject=["$scope","SubjectService","connectionService"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"="},templateUrl:"/modules/workspace/propertyType/number.tpl.html"}}function t(e){var t=e.property,n=this,a=angular.copy(t.compareRaw);n.numberArithmetic="x",n.numberComparison="y",null!==a&&void 0!==a&&(null!==a.numberArithmetic&&void 0!==a.numberArithmetic&&(n.numberArithmetic=a.numberArithmetic),null!==a.numberComparison&&void 0!==a.numberComparison&&(n.numberComparison=a.numberComparison)),e.$watch("vm.numberArithmetic",function(e){(""===e||null===e||void 0===e)&&(e="x"),t.compareRaw.numberArithmetic=e,t.arithmetic="x"===e?null:e.replace(/x/g,"%before_arithmetic%")}),e.$watch("vm.numberComparison",function(e){(""===e||null===e||void 0===e)&&(e="y"),t.compareRaw.numberComparison=e,t.compare="x"===e||"y"===e?null:e.replace(/x/g,"%before_arithmetic%").replace(/y/g,"%after_arithmetic%")})}function n(){return{require:"ngModel",link:function(e,t,n,a){function r(e){return function(t){var n=new RegExp(e.limitInput,"g"),r=t.toLowerCase().replace(n,"");return r=r.replace(/\s+/g," "),r!==t&&(a.$setViewValue(r),a.$render()),r}}a.$parsers.push(r(n))}}}angular.module("VSB.propertyType.number",["VSB.config"]).directive("numberPropertyDir",e).filter("replace",function(){return function(e,t){return _.isString(e)&&_.isObject(t)?(_.forEach(t,function(t,n){e=e.replace(n,t)}),e):e}}).directive("limitInput",n),t.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,controller:t,controllerAs:"vm",scope:{property:"="},templateUrl:"/modules/workspace/propertyType/date.tpl.html"}}function t(e){function t(){if(null!==a.dateComparison&&a.comparisonInput instanceof Date){var e=a.comparisonInput;n.compare=a.allowedDateComparisons[a.dateComparison].f.replace(/%input_start_of_day%/g,moment(e).hour(0).minute(0).second(0).format()).replace(/%input_end_of_day%/g,moment(e).hour(23).minute(59).second(59).format())}else n.compare=null}var n=e.property,a=this;a.open=function(e){e.preventDefault(),e.stopPropagation(),a.opened=!0};var r=angular.copy(n.compareRaw);a.allowedDateComparisons=[{label:"EQUALS",f:'xsd:dateTime(%after_arithmetic%) >= "%input_start_of_day%"^^xsd:dateTime&& xsd:dateTime(%after_arithmetic%) <= "%input_end_of_day%"^^xsd:dateTime'},{label:"EQUALS_NOT",f:'xsd:dateTime(%after_arithmetic%) < "%input_start_of_day%"^^xsd:dateTime|| xsd:dateTime(%after_arithmetic%) > "%input_end_of_day%"^^xsd:dateTime'},{label:"AFTER",f:'xsd:dateTime(%after_arithmetic%) > "%input_end_of_day%"^^xsd:dateTime'},{label:"BEFORE",f:'xsd:dateTime(%after_arithmetic%) < "%input_start_of_day%"^^xsd:dateTime'}],a.dropdown=_.map(a.allowedDateComparisons,function(e,t){return{click:function(){a.changeDateComparison(t)},template:'{{ "'+e.label+'" | translate}}'}}),a.getDateComparisonLabel=function(e){return a.allowedDateComparisons[e].label},a.changeDateComparison=function(e){a.dateComparison=e},a.dateComparison=0,a.comparisonInput=new Date,null!==r&&void 0!==r&&(null!==r.dateComparison&&void 0!==r.dateComparison&&(a.dateComparison=r.dateComparison),null!==r.comparisonInput&&void 0!==r.comparisonInput&&(a.comparisonInput=new Date(r.comparisonInput))),e.$watch("vm.dateComparison",function(e){n.compareRaw.dateComparison=e,n.compare="",t()}),e.$watch("vm.comparisonInput",function(e){n.compareRaw.comparisonInput=e,n.compare="",t()})}angular.module("VSB.propertyType.date",["zenubu.ngStrap"]).directive("datePropertyDir",e),t.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"A",replace:!0,scope:{property:"="},controllerAs:"vm",controller:t,templateUrl:"/modules/workspace/propertyType/aggregate.tpl.html"}}function t(e,t){var n=e.property,a=this;a.availableProperties=[],e.$watchCollection(function(){return t.getSubjectById(n.$subject.$id).$selectedProperties},function(e){a.availableProperties=_.reject(e,{type:"AGGREGATE_PROPERTY"})})}function n(){return function(e,t){return _.isEmpty(t)||(e=_.filter(e,{type:t})),e}}angular.module("VSB.propertyType.aggregate",[]).directive("aggregatePropertyDir",e).filter("aggregatePropertyFilter",n),t.$inject=["$scope","SubjectService"]}(),function(){"use strict";angular.module("VSB.propertyType",["VSB.propertyType.object","VSB.propertyType.aggregate","VSB.propertyType.number","VSB.propertyType.string","VSB.propertyType.date"])}(),function(){"use strict";function e(e,t,n,a,r,i){return function(s){var o={uri:null,type:null,filterExists:!0,hasFilter:!1,compareRaw:{},linkTo:null,view:!0,optional:!1,arithmetic:null,compare:null,$subject:{}};_.extend(o,s),o.$id=r.generateID(),r.addPropertyToSubject(o.$subject.$id,o.$id);var l=function(t){if(!_.isEmpty(t)){var n=angular.copy(t),r=[];return n.forEach(function(t){r.push(e.getSubAndEqClasses(t))}),a.all(r).then(function(e){e=_.uniq(_.flatten(e)),o.$range=e}).then(function(){o.typeCasted||"INVERSE_PROPERTY"===o.type||"AGGREGATE_PROPERTY"===o.type||(o.type=e.getPropertyType(o))})}};o.$copied?_.startsWith(o.uri,"$$")||e.getPropertyDetails(o.$subject.uri,o).then(function(e){return e=e[0],_.isEmpty(e)?null:(o.$range=e.$range,o.typeCasted||(o.type=e.type),e.$range)}).then(l)["catch"](function(e){t.error(e)}):l(o.$range);var c=null;return i.$on("$translateChangeSuccess",function(e,t){if(!o.$label||c!==t.language){var a=o.uri+".$comment",r=o.uri+".$label";n([a,r]).then(function(e){r!==e[r]&&(c=t.language,o.$label=e[r],o.$comment=a!==e[a]?e[a]:!1)})}}),o}}angular.module("VSB.property.model",["VSB.endPointService","pascalprecht.translate","VSB.connectionService"]).factory("Property",e),e.$inject=["EndPointService","$log","$translate","$q","connectionService","$rootScope"]}(),function(){"use strict";function e(){return{restrict:"E",replace:!0,scope:{property:"="},controller:t,controllerAs:"vm",templateUrl:"/modules/workspace/property/property.tpl.html"}}function t(e,t,n,a){function r(){a.open({template:"/modules/workspace/modals/addAppropriateClass.tpl.html",controller:"addAppropriateClassCtrl",resolve:{subject:function(){return t.getSubjectById(o.$subject.$id)},property:function(){return o}}})}function i(){a.open({template:"/modules/workspace/modals/castProperty.tpl.html",controller:"castPropertyCtrl",resolve:{property:function(){return o}}})}function s(t){o.hasOwnProperty(t)&&(o[t]=angular.copy(!o[t]),e.$evalAsync(function(){n.recalculateOffsets(o.$subject.$id,!0)}))}var o=e.property;o.$addAppropriateClass=r,n.addMapping(o.$id,e.$id);var l=this;l.toggle=s,l.dropdownConfig=[{hide:function(){return!(o.filterExists&&o.hasFilter)},click:function(){s("hasFilter")},template:'<i class="fa fa-fw fa-filter"></i> {{"REMOVE_FILTER" | translate}}'},{hide:function(){return!(o.filterExists&&!o.hasFilter)},click:function(){s("hasFilter")},template:'<i class="fa fa-fw fa-filter"></i> {{"ADD_FILTER" | translate}}'},{field:"filterExists",click:function(){s("filterExists")},templateArray:['<i class="fa fa-fw fa-check-square-o"></i> {{ "EXISTS" | translate }}','<i class="fa fa-fw fa-square-o"></i> {{ "EXISTS_NOT" | translate }}']},{hide:function(){return!(o.filterExists&&o.optional)},click:function(){s("optional")},template:'<i class="fa fa-fw fa-exclamation-circle"></i> {{"IS_MANDATORY" | translate}}'},{hide:function(){return!(o.filterExists&&!o.optional)},click:function(){s("optional")},template:'<i class="fa fa-fw fa-question-circle"></i> {{"IS_OPTIONAL" | translate}}'},{field:"view",click:function(){s("view")},templateArray:['<i class="fa fa-fw fa-eye"></i> {{ "SHOW_PROPERTY" | translate }}','<i class="fa fa-fw fa-eye-slash"></i> {{ "HIDE_PROPERTY" | translate }}']},{hide:function(){return!("RELATION_PROPERTY"===o.type||"INVERSE_PROPERTY"===o.type)},click:function(){r()},template:'<i class="fa fa-fw fa-plug"></i> {{"ADD_APPROPRIATE_CLASS" | translate}}'},{hide:function(){return!("RELATION_PROPERTY"!==o.type&&"INVERSE_PROPERTY"!==o.type&&"AGGREGATE_PROPERTY"!==o.type)},click:function(){i()},template:'<i class="fa fa-fw fa-magic"></i> {{"CAST_PROPERTY" | translate}}'},{click:function(){l.removeProperty(o.$id)},template:'<i class="fa fa-fw fa-trash-o"></i> {{"DELETE_PROPERTY" | translate}}'}],l.editAlias=!1,l.removeProperty=function(a){t.getSubjectById(o.$subject.$id,!0).removeProperty(a),e.$evalAsync(function(){n.recalculateOffsets(o.$subject.$id,!0)})},e.$on("$destroy",function(){})}angular.module("VSB.property.instance",["VSB.config","VSB.filters","VSB.arrowService"]).directive("propertyDir",e),t.$inject=["$scope","SubjectService","connectionService","$modal"]}(),function(){"use strict";angular.module("VSB.property",["VSB.property.model","VSB.property.instance","VSB.propertyType"])}(),function(){"use strict";function e(e,t,n,a,r,i){e.property=t,e.subject=a,e.search={},e.availableSubjects=[],e.arrowClass="RELATION_PROPERTY"===t.type?"fa-long-arrow-right":"fa-long-arrow-left",e.selected=null,e.select=function(t){e.selected=e.selected===t?null:t},e.ok=function(){if(null!==e.selected){var a=n.addSubjectByURI(angular.copy(e.selected.uri));t.hasFilter=!0,t.linkTo=a}r.dismiss()},e.cancel=r.dismiss,i.getFromCache("availableClasses").then(function(n){e.availableSubjects=_(n).filter(function(e){return _.contains(t.$range,e.uri)}).value()})}angular.module("VSB.modals",["zenubu.ngStrap","VSB.subject.service"]).controller("addAppropriateClassCtrl",e),e.$inject=["$scope","property","SubjectService","subject","$modalInstance","translationCacheService"]}(),function(){"use strict";function e(e,t,n,a,r){function i(e){return _(e.items).filter(function(e){return _.contains(n,e.uri)}).value()}e.search={},e.subjects=_.cloneDeep(t),e.subjects[0].$availableProperties=[],e.subjects[1].$availableProperties=[],t[0].getAvailableProperties(":relation",null).then(i).then(function(t){e.subjects[0].$availableProperties=t}),t[1].getAvailableProperties(":relation",null).then(i).then(function(t){e.subjects[1].$availableProperties=t}),e.subjects[0].$id===e.subjects[1].$id&&(e.dontShowSecond=!0),e.subject1=t[0].alias,e.subject2=t[1].alias,t[0].$searchRelation=!1,t[1].$searchRelation=!1,e.selected=null,e.fromIDX=null,e.select=function(t,n){e.selected===t&&e.fromIDX===n?(e.selected=null,e.fromIDX=null):(e.selected=t,e.fromIDX=n,e.toIDX=0===n?1:0)},e.ok=function(){if(null!==e.selected){var n=a.getSubjectById(t[e.fromIDX].$id),i=a.getSubjectById(t[e.toIDX].$id),s=angular.copy(e.selected);s.hasFilter=!0,s.linkTo=i,s.$copied=!0,n.addProperty(s)}r.dismiss()},e.cancel=r.dismiss}angular.module("VSB.modals").controller("findRelationModalCtrl",e),e.$inject=["$scope","subjects","possibleRelations","SubjectService","$modalInstance"]}(),function(){"use strict";function e(e,t,n){e.property=t,e.availableCasts=["DATE_PROPERTY","STRING_PROPERTY","NUMBER_PROPERTY"],e.selected=t.type,e.select=function(t){e.selected=e.selected===t?null:t},e.ok=function(){null!==e.selected&&(t.type=e.selected,t.compareRaw={},t.compare=null,t.typeCasted=!0),n.dismiss()},e.cancel=n.dismiss}angular.module("VSB.modals").controller("castPropertyCtrl",e),e.$inject=["$scope","property","$modalInstance"]}(),function(){"use strict";function e(){function e(e){var a=_.lastIndexOf(o,e);if(a!==o.length-1){o.push(e);var r=_.lastIndexOf(o,e);n(e,a,r),t()}}function t(){var e=_.uniq(o);o.length-e.length<3||(o=_(e).sortBy(function(e){return _.lastIndexOf(o,e)}).forEach(function(e,t){var a=_.lastIndexOf(o,e);n(e,a,t)}).value())}function n(e,t,n){_.forEach(l[e],function(a,r){return null===a._jsPlumb?void delete l[e][r]:(a.removeClass("z-index-"+t),void a.addClass("z-index-"+n))}),l[e]=_.compact(l[e]),c[e].removeClass("z-index-"+t),c[e].addClass("z-index-"+n)}function a(){o=[],l={}}function r(e){return-1===_.lastIndexOf(o,e)&&o.push(e),_.lastIndexOf(o,e)}function i(e,t){var n=r(e);t.addClass("z-index-"+n),c[e]=t}function s(e,t){var n=_.lastIndexOf(o,e);_.isArray(l[e])||(l[e]=[]),t.addClass("z-index-"+n),l[e].push(t)}var o=[],l={},c={};return{increaseIndex:e,getSubjectIndex:r,registerSubject:i,registerEndpoint:s,reset:a}}angular.module("VSB.zIndex",["VSB.config"]).factory("zIndexService",e)}(),function(){"use strict";function e(e,t,n,a){function r(e){return p(e)}function i(e,n){t.updateConnectionLabel(e,n)}function s(){return h+=1,"i"+h}function o(e){return function(){_.forEach(_.invert(w,!0)[e],function(t){_.isFunction(E[t])&&E[t](e),delete w[t]}),delete E[e],delete S[e],delete b[e],delete y[e],p()}}function l(t){var n=[];return S.hasOwnProperty(t)?n=_.map(S[t],function(e){return c(e).then(o(e))}).push(c(t)):(n.push(c(t).then(o(t))),S=_.mapValues(S,function(e){return _.without(e,t)})),e.all(n).then(o(t))}function c(n){return e.when(m(n)).then(function(e){return t.deleteAllConnections(e)}).then(function(e){return delete w[n],p(),e})}function u(e,n,a){var r=[];return Promise.all([m(e),m(n),m(y[e])]).cancellable().then(function(t){return r=t,c(e)}).then(function(){return r[1]?(w[e]=n,p(),r[1]===r[2]?t.connectToSelf(r[0],r[2]):t.connect(r[0],r[1],a,r[2]).then(function(e){return t.recalculateOffsets(r[0]),e})):void 0})["catch"](Promise.CancellationError,function(){return c(e)})}function p(e){var t=[];_.forEach(S,function(e,n){t.push([n,n])}),_.forEach(w,function(e,n){var a=y[n];e&&a&&t.push([a,e])}),t=angular.copy(t);var n={},r=_.keys($);$={},t.forEach(function(e){var a=n[e[0]]?n[e[1]]?!1:e[1]:e[0];if(a){var r=P(a,t,n);$[_.min(r,function(e){return 1*e.substring(1)})]=r}});var i=_.xor(r,_.keys($));return!e&&i.length>0&&a.$emit("connectionGroupsChanged"),$}function d(e,t){b[e]=t}function f(e){S[e]=[],p()}function m(t){return"startpoint"===t?e.when(t):b[t]?e.when(b[t]):n(function(){return m(t)},150)}function g(e,t){S[e].push(t),y[t]=e}function v(){return[S,y,b,w,$]}var h=-1,b={},S={},y={startpoint:"startpoint"},w={},$={},E={},R={};R.getConnections=v,R.addSubject=f,R.addMapping=d,R.getScopeID=m,R.addPropertyToSubject=g,R.generateID=s,R.remove=l,R.disconnect=c,R.connect=u,R.updateConnectionLabel=i,R.getGroups=r,R.resetService=function(){t.resetService(),b={}},R.recalculateOffsets=function(e,n){m(e).then(function(e){t.recalculateOffsets(e,n)})},R.registerDestroyWatcher=function(e,t){E[e]=t};var P=function(e,t,n){function a(t){t[0]!==e||n[t[1]]?t[1]!==e||n[t[0]]||r.push(t[0]):r.push(t[1])}var r=[],i=[];for(r.push(e);r.length>0;)e=r.shift(),n[e]||(n[e]=!0,i.push(e),t.forEach(a));return i};return R}angular.module("VSB.connectionService",["VSB.arrowService"]).factory("connectionService",e),e.$inject=["$q","ArrowService","$timeout","$rootScope"]}(),function(){"use strict";function e(e,t,n){function a(){if(null!==r){var t=e.defer();return t.resolve(r),t.promise}return e.when(jsPlumb.ready(function(){r=jsPlumb.getInstance({Endpoint:["Dot",{cssClass:"hidden"}],ConnectionOverlays:[["Arrow",{location:1,id:"arrow",cssClass:"arrow",length:14,foldback:.8}],["Label",{label:"",id:"label",cssClass:"connector-label"}]],Container:"workspace"}),r.bind("connection",function(e){var t=e.connection.getParameter("label");if(null===t)e.connection.removeOverlay("label");else{var a=e.connection.getOverlay("label");n.registerEndpoint(e.connection.getParameter("sourceParent"),a),a.setLabel(t)}})})).then(function(){return r})}for(var r=null,i=[],s=0;1>=s;s+=1)for(var o=0;1>=o;o+=.125){var l=0,c=0;l=0===o?-1:l,l=1===o?1:l,0!==l&&(c=0===s?20:c,c=1===s?-20:c),i.push([o,s,l,0,0,c])}var u=[[1,.5,1,0,0,0,"right"],[0,.5,-1,0,0,0,"left"]];return{makeDraggable:function(e,t){return _.isNumber(e)&&(e+=""),a().then(function(n){return n.draggable(e,t)})},connectToSelf:function(e,t){return e=e.toString(),a().then(function(a){var r=a.connect({source:e,target:e,connector:["Bezier",{showLoopback:!1,curviness:50,proximityLimit:0}],cssClass:"connector connector-self",anchors:[[1,.25,1,0],[1,.75,1,0]],parameters:{label:null}});return n.registerEndpoint(t,r),r})},connect:function(e,r,s,o){return t.debug("connect",e,r,s),e=e.toString(),r=r.toString(),a().then(function(t){var a=t.connect({source:e,target:r,cssClass:"connector",endpoints:["Blank","Blank"],anchors:[u,i],connector:"Bezier",parameters:{label:s,sourceParent:o}});
return n.registerEndpoint(o,a),t.repaintEverything(),a})},repaintEverything:function(){return a().then(function(e){return e.repaintEverything()})},detach:function(e){return a().then(function(t){return null!==e?t.detach(e):void 0})},deleteAllConnections:function(e){return e=e.toString(),a().then(function(t){return t.setSuspendDrawing(!0),null!==e&&t.removeAllEndpoints(e),t.setSuspendDrawing(!1),t.repaintEverything()})},updateConnectionLabel:function(e,t){return null!==e?e.getOverlay("label").setLabel(t):void 0},recalculateOffsets:function(e,t){return e=e.toString(),a().then(function(n){n.recalculateOffsets(e),t&&n.repaintEverything()})},resetService:function(){null!==r&&(r.cleanupListeners(),r.reset()),r=null}}}angular.module("VSB.arrowService",["VSB.config","VSB.zIndex"]).factory("ArrowService",e),e.$inject=["$q","$log","zIndexService"]}(),function(){"use strict";angular.module("zenubu.ngStrap",["mgcrea.ngStrap","ngSanitize","zenubu.ngStrap.datepicker","zenubu.ngStrap.dropdown","zenubu.ngStrap.modal"]).config(["$tooltipProvider",function(e){angular.extend(e.defaults,{html:!0})}])}(),function(){"use strict";angular.module("VSB.print",[]).factory("PrintService",["$window","$rootScope","$timeout","ArrowService","$q","MessageService",function(e,t,n,a,r,i){function s(){if(!c){c=!0,_.forEach(l,function(e){e.triggerHandler("beforePrint")});var e=t.$$phase;return"$apply"!==e&&"$digest"!==e&&t.$digest(),n(function(){a.repaintEverything(),c=!1,i.addMessage({message:'<span translate="PRINT_PREVIEW_MESSAGE"></span>',dismiss:o,dismissText:"CLOSE_PREVIEW",icon:"print","class":"success"})},100,!1)}}function o(){_.forEach(l,function(e){e.triggerHandler("afterPrint")});var e=t.$$phase;"$apply"!==e&&"$digest"!==e&&t.$digest(),n(function(){a.repaintEverything()},0)}var l={},c=!1;return{beforePrint:s,registerListener:function(e,t){l[e]=t},unregisterListener:function(e){delete l[e]}}}]).directive("onBeforePrint",["PrintService",function(e){return function(t,n,a){function r(){t.$eval(a.onBeforePrint)}function i(){t.$eval(a.onAfterPrint)}e.registerListener(t.$id,n),n.on("beforePrint",r),n.on("afterPrint",i),t.$on("$destroy",function(){n.off("beforePrint",r),n.off("afterPrint",i),e.unregisterListener(t.$id)})}}])}(),function(){"use strict";function e(e,t,n,a,r,i,s,o){var l=this;l.changeLanguage=function(e){n.use(e)};var c;l.translate=function(){null===r.mainSubject?(i.dismiss(c),c=i.addMessage({message:'{{ "MINIMUM_SUBJECTS" | translate }}',"class":"warning",icon:"exclamation-triangle"})):t.go("result")},l.print=function(){o.beforePrint()},l.resetWorkspace=function(){s.removeItem("current"),a.debug("Cleared Workspace"),r.reset(),e.translatedJSON="In the near future the translated JSON will be here.",e.translatedSPARQL="In the near future the translated SPARQL will be here."}}angular.module("VSB.layout.workspace.navigation",[]).controller("WorkspaceNavigationCtrl",e),e.$inject=["$scope","$state","$translate","$log","SubjectService","MessageService","$localForage","PrintService"]}(),function(){"use strict";function e(e,t,n,a,r,i){function s(t){t&&(e.addSubjectByURI(t),u.selectedSubject=void 0)}function o(e){p=e.pageX,d=e.pageY,u.mouseDown=!0}function l(e){if(u.mouseDown){var n={x:e.pageX-p,y:e.pageY-d};r.$emit("moveSubjectDrag",n),p=e.pageX,d=e.pageY,t.repaintEverything()}}function c(){r.$emit("moveSubjectEnd"),u.mouseDown=!1,t.repaintEverything()}var u=this;u.groups=[],u.availableSubjectClasses=[],u.totalItems=0,u.matchingItems=0,u.selectedSubject=void 0,u.subjects=e.subjects,u.addSubject=s,u.workspaceMouseDown=o,u.workspaceMouseMove=l,u.workspaceMouseUp=c,u.searchSubject=null,n.resetService(),a.reset(),u.loading=!0,i.when(e.loading).then(function(){u.loading=!1,u.refreshClasses("")});var p=0,d=0;u.mouseDown=!1,r.$on("translateEverything",function(){u.refreshClasses("")}),u.refreshClasses=function(t){return e.getAvailableClasses(t,50).then(function(e){var t=_.xor(_.pluck(e.items,"uri"),_.pluck(u.availableSubjectClasses,"uri"));t.length>0&&(u.availableSubjectClasses=e.items,u.totalItems=e.total,u.matchingItems=e.matching)})},u.groups=e.groups,null!==e.mainSubject&&(u.mainSubject=e.mainSubject,e.redrawMainConnection(e.mainSubject)),r.$on("mainSubjectChanged",function(){u.mainSubject=e.mainSubject}),r.$on("availableGroupsChanged",function(){u.groups=e.groups}),u.updateMainSubject=function(){e.setMainSubjectWithAlias(u.mainSubject.alias)}}angular.module("VSB.layout.workspace",["VSB.modals","VSB.print","ngSanitize","VSB.select","VSB.config","VSB.endPointService","VSB.parser","VSB.arrowService","LocalForageModule"]).controller("WorkspaceCtrl",e),e.$inject=["SubjectService","ArrowService","connectionService","zIndexService","$rootScope","$q"]}(),function(){"use strict";function e(e,t,n,a){function r(e){return e=a("beautifySPARQL")(e),e=a("replaceURIsWithPrefixes")(e)}function i(){var t="&format="+encodeURIComponent(e.currentFormat.format),a="&query="+encodeURIComponent(e.translatedSPARQL),r="";return n.defaultGraphURIs.forEach(function(e){r+="&default-graph-uri="+encodeURIComponent(e)}),e.currentFormat.qtxt&&(a="&qtxt="+encodeURIComponent(e.translatedSPARQL),r=""),-1===n.resultURL.indexOf("?")?n.resultURL+"?"+t+r+a:n.resultURL+t+r+a}e.resultHead=[],e.resultData=[],e.showQueries=!0,e.resultFormats=n.resultFormats,e.currentFormat=n.resultFormats[0];var s=t.translateVSBLToSPARQL();e.translatedJSON=s.json;var o="";_.forEach(n.prefixes,function(e,t){o+="prefix "+t+": <"+e+"> \n"}),e.translatedSPARQL=o+"\n"+r(s.sparql.toString()),e.openInNewTab=function(){var e=window.open(i(),"_blank");e.focus()}}function t(){return function(e,t){if(0===t.length)return e;var n=1;return _.startsWith(t[0],"-")&&(n=-1),t=t[0].substring(1),e.sort(function(e,a){return n*e[t].value.localeCompare(a[t].value)})}}angular.module("VSB.layout.result",["VSB.config"]).filter("deepOrderBy",t).controller("ResultCtrl",e),e.$inject=["$scope","ParserManager","globalConfig","$filter"]}(),function(){"use strict";function e(e,t){return{link:function(n,a){a.bind("change",function(n){var r=new FileReader;r.onload=function(n){a.val(null);var r=JSON.parse(n.target.result);t.reset().then(function(){e.translateJSONToVSBL(r)})},r.readAsText(n.target.files[0])})}}}function t(e,t,n){var a={};return a.translateVSBLToSPARQL=function(){var a=t.parseVSBL2JSON();if(null===a)return void e.error("JSON is not valid / empty");var r=n.translateJSONToSPARQL(JSON.parse(a)),i=n.translateJSONToSponateMap(JSON.parse(a));return{json:a,sparql:r,sponateMap:i}},a}angular.module("VSB.parser",["VSB.config","VSB.parser.VSBL2JSON","VSB.parser.VSBL2SPARQL","VSB.parser.JSON2VSBL","LocalForageModule"]).factory("ParserManager",t).directive("jsonreader",e),e.$inject=["TranslatorToVSBL","SubjectService"],t.$inject=["$log","ParserVSBL2JSON","ParserToSPARQL"]}(),function(){"use strict";function e(){function e(e){var t=new RegExp("[^A-Za-z0-9_?]","g");return e.replace(t,"_").replace(/_+/g,"_").replace(/^_|_$/,"")}function t(t,n,a,r,i){return null!==r&&(a=d.NodeFactory.createVar(e(r)),i=!1),{s:t,p:n,o:a,view:i}}function n(t,n,a){var r=e(n+" "+t.linkTo),i=e(r+" "+t.uri),c=d.NodeFactory.createVar(i),u=d.NodeFactory.createVar(r);return t.operator=t.operator.replace(/%alias%/g,u),a&&!s.contains(c)&&l.add(c,t.operator),o.add(u),[]}function a(a,r,i){var o,l=e(r+" "+a.alias),c=a.uri,u=a.type,f=new p.ElementTriplesBlock,g=d.NodeFactory.createVar(r),v=d.NodeFactory.createUri(c),h=d.NodeFactory.createVar(l),b=h,S=i&&a.view;return"AGGREGATE_PROPERTY"===u?n(a,r,S):"$$uri"===c?(null!==a.compare&&(a.compare=a.compare.replace(/%before_arithmetic%/g,g).replace(/%after_arithmetic%/g,g),f.addTriples([new p.ElementFilter(a.compare)])),f):("INVERSE_PROPERTY"===u?(o=t(g,v,h,a.linkTo,S),g=o.o,b=o.s,S=o.view,u="RELATION_PROPERTY"):"RELATION_PROPERTY"===u&&(o=t(g,v,h,a.linkTo,S),b=o.o,S=o.view),a.filterExists?(a.hasFilter&&null!==a.arithmetic&&(b=d.NodeFactory.createVar(e(l+" temp"))),f.addTriples([new d.Triple(g,v,b)]),a.hasFilter&&(null!==a.arithmetic&&(a.arithmetic=a.arithmetic.replace(/%before_arithmetic%/g,b).replace(/%after_arithmetic%/g,h),f.addTriples([new p.ElementBind(h,a.arithmetic)])),null!==a.compare&&(a.compare=a.compare.replace(/%before_arithmetic%/g,b).replace(/%after_arithmetic%/g,h),f.addTriples([new p.ElementFilter(a.compare)]))),S&&!s.contains(d.NodeFactory.createVar(l))&&(s.add(d.NodeFactory.createVar(l)),"RELATION_PROPERTY"===u&&m.add(d.NodeFactory.createVar(l)))):f.addTriples([new p.ElementFilter("NOT EXISTS {"+(new d.Triple(g,v,h).toString()+"}"))]),a.optional?new p.ElementOptional(f):f)}function r(t){var n=e(t.alias),r=d.NodeFactory.createVar(e(n)),i=d.NodeFactory.createUri(t.uri),o=new p.ElementTriplesBlock;return o.addTriples([new d.Triple(r,f.rdf.type,i)]),t.view&&!s.contains(r,n)&&(s.add(r),m.add(r),""===g&&(g=r)),t.hasOwnProperty("properties")&&t.properties.forEach(function(e){o.addTriples(a(e,n,t.view))}),o}function i(e){var t=new p.VarExprList;return s.entries().forEach(function(e){o.contains(e.v)||t.add(e.v,e.expr)}),e||l.entries().forEach(function(e){o.contains(e.v)||t.add(e.v,e.expr)}),t}var s,o,l,c={},u=new Jassa(Promise,$.ajax),p=u.sparql,d=u.rdf,f=u.vocab,m=new p.VarExprList,g="";return c.translateJSONToSPARQL=function(e){l=new p.VarExprList,s=new p.VarExprList,o=new p.VarExprList;var t=new p.Query,n=new p.ElementTriplesBlock;return e.hasOwnProperty("SUBJECTS")&&e.SUBJECTS.forEach(function(e){n.addTriples(r(e))}),t.setQueryPattern(n),t.setProjectVars(i()),t.setDistinct(!0),l.entries().length>0&&(t.groupBy=i(!0).vars),t},c.translateJSONToSponateMap=function(e){l=new p.VarExprList,m=new p.VarExprList,g="",s=new p.VarExprList,o=new p.VarExprList;var t,n=new p.ElementTriplesBlock;return e.hasOwnProperty("SUBJECTS")&&e.SUBJECTS.forEach(function(e){n.addTriples(r(e))}),t={name:(new Date).toISOString(),template:[{id:g.toString(),rows:[{id:"?rowId"}]}],from:n.toString()},i().getVars().forEach(function(e){var n=e.toString().replace(/^\?/,"");m.contains(e)&&(n="$"+n),t.template[0].rows[0][n]=e.toString()}),t},c}angular.module("VSB.parser.VSBL2SPARQL",[]).factory("ParserToSPARQL",e)}(),function(){"use strict";function e(e,t,n,a,r){var i=function(e){for(var t in e)e.hasOwnProperty(t)&&(_.startsWith(t,"$")||"function"==typeof e[t])&&delete e[t];return e},s={};return s.parseVSBL2JSON=function(){t.debug("Translate VSBL to JSON");var s={CONFIG:n.name,START:{type:"LIST_ALL",linkTo:r.getMainSubject().alias},SUBJECTS:[]},o=_.cloneDeep(r.getSubjects());return o.map(function(e){return e.properties=e.$selectedProperties.map(function(e){return e.linkTo="STANDARD_PROPERTY"!==e.type&&_.isObject(e.linkTo)&&e.linkTo.hasOwnProperty("alias")?e.linkTo.alias:null,i(e)}),i(e)}),s.SUBJECTS=o,a.setItem("current",s).then(function(){t.debug("Current Workspace saved into localForage")},function(){t.debug("Saving to localForage failed",arguments)}),e.$emit("updateJSON",JSON.stringify(s,null,2)),JSON.stringify(s,null,2)},s}angular.module("VSB.parser.VSBL2JSON",["VSB.config","LocalForageModule"]).factory("ParserVSBL2JSON",e),e.$inject=["$rootScope","$log","globalConfig","$localForage","SubjectService"]}(),function(){"use strict";function e(e,t){var n={};return n.translateJSONToVSBL=function(n){if(t.debug("Translate JSON to VSBL"),null===n)return t.error("Empty JSON File"),null;var a=[];n.SUBJECTS.forEach(function(t){t.$copied=!0;var n=t.properties;delete t.properties;var r=[];t=e.addSubject(t),n.forEach(function(e){e.$copied=!0,e=t.addProperty(e),e.linkTo&&("AGGREGATE_PROPERTY"!==e.type?a.push(e):r.push(e))}),r.forEach(function(e){var n=_.where(t.$selectedProperties,{alias:e.linkTo});n.length>0&&(e.linkTo=n[0])})}),a.forEach(function(t){e.linkSubjectWithProperty(t)}),e.setMainSubjectWithAlias(n.START.linkTo)},n}angular.module("VSB.parser.JSON2VSBL",["VSB.config","VSB.property.model","VSB.subject.model"]).factory("TranslatorToVSBL",e),e.$inject=["SubjectService","$log"]}(),function(){"use strict";angular.module("VSB.message",[]).factory("MessageService",function(){var e=[];return{messages:e,addMessage:function(t){return _.isString(t)&&(t={message:t,"class":"info"}),t["class"]="alert-"+t["class"],t.icon&&(t.icon="fa-"+t.icon),e.push(t),t},dismiss:function(t,n){return _.isObject(t)&&(!n&&_.isFunction(t.dismiss)&&t.dismiss(),_.remove(e,t)),null}}}).directive("messages",function(){return{restrict:"A",scope:!0,replace:!0,controller:["MessageService",function(e){var t=this;t.messages=e.messages,t.dismiss=e.dismiss}],controllerAs:"vm",template:'<div class="messageContainer" ><div class="alert" ng-class="message.class" ng-repeat="message in vm.messages" ><a class="pull-right alert-link" href="" ng-click="vm.dismiss(message)"><i class="pull-left fa fa-lg fa-times"></i><span ng-if="message.dismissText" translate="{{message.dismissText}}"></span></a><i class="pull-left fa fa-lg fa-fw" ng-if="message.icon" ng-class="message.icon" ></i><span compile="message.message"></span></div></div>'}})}(),function(){"use strict";function e(e,t,n,a){function r(t){return void 0!==o[t]?n.when(o[t]):s.hasOwnProperty(t)&&!_.isEmpty(s[t])?e.refresh().then(function(){var a=[];return _.forEach(s[t].values,function(n){var r=n.uri+".$label",o=n.uri+".$comment",l=e([r,o]).then(function(e){var a=e[o]===o?!1:e[o];return"class"===s[t].type?i(n,a,e[r]):(n.$comment=a,n.$label=e[r],n)});a.push(l)}),n.all(a)}).then(function(e){return e=_.sortBy(e,function(e){return e.$label.toLocaleLowerCase()}),o[t]=e,n.when(e)}):n.when([])}function i(e,t,n){return{uri:e.uri,$comment:t,$label:n}}var s={},o={},l={getFromCache:r,putInCache:function(e,t,n){return s[e]={type:t,values:n},r(e)},removeFromCache:function(e){delete o[e],delete s[e]}},c=null;return t.$on("$translateChangeSuccess",function(e,n){n.language===c||_.isEmpty(o)||(a.debug("changed Language to",n.language),c=n.language,o={},t.$emit("translateEverything"))}),l}angular.module("VSB.language.translationCacheService",["VSB.config","pascalprecht.translate"]).factory("translationCacheService",e),e.$inject=["$translate","$rootScope","$q","$log"]}(),function(){"use strict";function e(e){return function(t,n,a){if(!n)return t;a||(a="");var r=angular.copy(t);return r.map(function(t){return t[n]=e.instant(a+t[n]),t}).sort(function(e,t){return"string"==typeof e[n]&&"string"==typeof t[n]?e[n].toLowerCase().localeCompare(t[n].toLowerCase()):void 0})}}function t(e,t){t.fallBackLanguages.push("default"),e.useLoader("languageLoader").fallbackLanguage(t.fallBackLanguages).determinePreferredLanguage()}function n(e){return function(t){return e.getItem(t.key)}}function a(e,t,n){var a,r={"default":{ADD_FILTER:"add filter",AFTER:"after",ARITHMETICS:"arithmetics",A_LINK_TO:"a link to",BACK_TO_WORKSPACE:"Workspace",BEFORE:"before",BUTTON_LANG_DE:"german",BUTTON_LANG_EN:"english",MIXED_CONTENT_WARNING:"You are trying to view mixed content.<br>Your browser may be blocking data from the endpoint. (The Visual SPARQL Builder is running on {{ VSBProtocol }}, your SPARQL endpoint on {{EndpointProtocol}})<br>In <b>Firefox</b> you need to navigate to <a class='alert-link' href='{{VSBLink}}'>the {{EndpointProtocol}} version of this site.</a><br>In <b>Chrome</b> you could click on the little armor in the URL bar and 'Load unsafe scripts' or also navigate to the Firefox link.",CLASSES_FOUND_ZERO:"No classes found.<br>Please try another search term.",CLASSES_FOUND_X:"Found {{matching}} classes.<br>Total classes: {{total}}",CLASSES_FOUND_X_MORE:"Showing {{x}} of {{matching}} found classes.<br>Total classes: {{total}}",CLASSES_FOUND_NO_SEARCH:"Showing {{matching}} of {{total}} classes<br>Please enter a search term.",PROPERTIES_FOUND_ZERO:"No properties found.<br>Please try another search term.",PROPERTIES_FOUND_X:"Found {{matching}} properties.<br>Total properties: {{total}}",PROPERTIES_FOUND_X_MORE:"Showing {{x}} of {{matching}} found properties.<br>Total properties: {{total}}",PROPERTIES_FOUND_NO_SEARCH:"Showing {{matching}} of {{total}} properties<br>Please enter a search term.",CHOOSE_A_PROPERTY:"Choose a property",CHOOSE_A_SUBJECT:"Choose a subject",COMPARISON:"comparison",CONTAINS:"contains",DELETE_PROPERTY:"delete property",DOWNLOAD_JSON:"Download JSON",ENDS_WITH:"ends with",EQUALS:"equals",EQUALS_NOT:"equals not",EXISTS:"exists",EXISTS_NOT:"exists not",HELP:"Help",HIDE_PROPERTY:"hide property",HIDE_QUERIES:"hide queries",IS_MANDATORY:"is mandatory",IS_OPTIONAL:"is optional",KEEP_OPEN:"Keep open",HIDE_SUBJECT:"Hide Subject",SHOW_SUBJECT:"Show Subject",DELETE_SUBJECT:"Delete Subject",CONNECT_SUBJECT:"Connect Subject to another Subject",ADD_APPROPRIATE_CLASS:"Add appropriate Subject",CAST_PROPERTY:"Change property type",LANGUAGE:"language",LINK_WITH_SUBJECT:"Link with a subject",LIST_ALL:"List all",LOAD_JSON:"Load JSON",NO_COMPARISON:"no comparison",PICK_MAIN_SUBJECT:"Pick a main subject",PROPERTY:"property",QUERIES:"Queries",REGEX:"regex",REMOVE_FILTER:"remove filter",RESET_WORKSPACE:"Reset Workspace",RESULTS:"Results",RUN_QUERY:"Run Query",SEARCH_RELATION:'To Search a Relation between {{alias}} and another subject, please click on the <i class="fa fa-plug fa-fw"></i> plug button of this subject.',SELECT_LANGUAGE:"Select a language",SHOW_PROPERTY:"show property",SHOW_QUERIES:"show queries",STARTS_WITH:"starts with",WORKSPACE:"Workspace",TITLE:"Visual SPARQL Builder",TITLE_SHORT:"VSB"}},i={};return i.mergeLanguages=function(e){n.debug("Missing de translations",_.difference(_.keys(e.en),_.keys(e.de))),n.debug("Missing en tranlsations",_.difference(_.keys(e.de),_.keys(e.en))),r=_.merge(r,e)},i.setItem=function(t,n,a){return r.hasOwnProperty(t)||(r[t]={}),r[t][n]=a,e.when(a)},i.getItem=function(t){var n=e.defer();return n.resolve(r.hasOwnProperty(t)?r[t]:{}),e.when(a).then(function(){return n.promise})},a=t.get("locale.json").success(function(e){i.mergeLanguages(e)}),i}angular.module("VSB.language",["VSB.config","VSB.language.translationCacheService","pascalprecht.translate"]).config(t).factory("languageStorage",a).factory("languageLoader",n).filter("translateAndSortLocalizedObjectArrayByKey",e),e.$inject=["$translate"],t.$inject=["$translateProvider","globalConfig"],n.$inject=["languageStorage"],a.$inject=["$q","$http","$log"]}(),function(){"use strict";function e(e,t,r,i){function s(n){if(_.isFunction(n)){var a=n(e,t);t=_.isString(a.filter)?a.filter:t,e=_.isArray(a.array)?a.array:e}}if(!_.isArray(e))return e;i=_.isObject(i)?{post:_.flatten([i.post]),pre:_.flatten([i.pre])}:{post:_.flatten([i])},t=_.isString(t)?angular.copy(t):null,r=_.isString(r)||_.isNumber(r)?angular.copy(r):null;var o=e.length,l=null;if(!_.isNull(t)){_.forEach(i.pre,s);var c=a(t),u=_.map(c,function(e){return new RegExp(_.escapeRegExp(e),"i")});e=_.filter(e,function(e){return _.every(u,function(t){return _.some(e,function(e){return _.isString(e)&&_.deburr(e).match(t)})})}),l=e.length,e=n(e,c),_.forEach(i.post,s)}return _.isNull(r)||(e=_.take(e,r)),{items:e,total:o,matching:l}}function t(e,t){if(!_.isString(e)||!_.isString(t))return e;var n=a(t);return _.forEach(n,function(t){var n=_.deburr(e).toLowerCase();n=n.replace(new RegExp(_.escapeRegExp(t),"ig"),"||");var a=0;n=_.reduce(n.split("||"),function(e,n){return e.push([a,n.length]),a+=n.length+t.length,e},[]),e=_.reduce(n,function(n,a){var r=e.substr(a[0],a[1]),i=e.substr(a[0]+a[1],t.length),s=i.length>0?"<>"+i+"</>":"";return n+r+s},"")}),e.replace(/<>/g,'<span class="ui-select-highlight">').replace(/<\/>/g,"</span>")}function n(e,t){if(!_.isArray(e)||!_.isArray(t)||_.isEmpty(t))return e;t=_.map(t,_.escapeRegExp).join("|");var n=new RegExp("^("+t+")","i"),a=new RegExp(t,"i");return _.sortBy(e,function(e){var t=_.deburr(e.$label);return _.isString(t)?t.match(n)?10:t.match(a)?25:50:100})}function a(e){return e=_.words(_.deburr(e).toLowerCase(),/[^ <>,]+/g),e=_.sortBy(e,"length"),_.reduceRight(e,function(e,t){return _.contains(e.join(", "),t)||e.push(t),e},[])}function r(e){e.decorator("uiSelectChoicesDirective",["$delegate",function(e){function t(){return r=s.apply(this,arguments),n}function n(e,t,n,i){r.apply(this,arguments),n.$observe("totalItems",function(e){i.totalItems=e}),n.$observe("matchingItems",function(e){i.matchingItems=e}),e.footerZero=n.footerZero,e.footerNoSearch=n.footerNoSearch,e.footerFound=n.footerFound,i.containsSearchTerm=function(e,t){return t&&e?_.deburr(e).match(new RegExp(_.map(a(t),_.escapeRegExp).join("|"),"i")):!1}}var r,i=e[0],s=i.compile;return i.compile=t,e}])}angular.module("VSB.select",["ui.select"]).config(["uiSelectConfig",function(e){e.theme="/components/ui.select"}]).directive("uiSelectChoicesRowInner",function(){return{restrict:"E",replace:!0,templateUrl:"/components/ui.select/choiceRowInner.tpl.html"}}).filter("highlightSearchTerm",function(){return t}).config(r).factory("helperFunctions",function(){return{filterByTokenStringWithLimit:e,highlightSearchTermDeburred:t}}),r.$inject=["$provide"]}(),function(){"use strict";function e(e,t){e.state("workspace",{url:"/workspace",views:{content:{controller:"WorkspaceCtrl",controllerAs:"vm",templateUrl:"/modules/workspace/content.tpl.html"},navigation:{controller:"WorkspaceNavigationCtrl",controllerAs:"vm",templateUrl:"/modules/workspace/navigation.tpl.html"}}}),e.state("result",{url:"/result",views:{content:{controller:"ResultCtrl",controllerAs:"vm",templateUrl:"/modules/result/content.tpl.html",resolve:{JSON:["ParserManager","$timeout",function(e,t){return t(function(){return e.translateVSBLToSPARQL()},300)}]}},navigation:{templateUrl:"/modules/result/navigation.tpl.html"}}}),t.otherwise("/workspace")}function t(e,t){var n=e.$on("$stateChangeStart",function(e,a){return"workspace"===a.name?void n():(e.preventDefault(),void t.go("workspace"))})}function n(e,t,n,a,r){function i(i){return _.isBoolean(i)||(i=!0),n.setItem("switchStatus",[i]).then(function(){return e.switchStatus=i,t.$emit("mainOffset",i),r(function(){a.repaintEverything()},0),i})}e.switchStatus=!0,e.setSwitchStatus=function(e){i(e).then(function(e){e?t.$emit("moveSubjectDrag",{x:200,y:0},!0):t.$emit("moveSubjectDrag",{x:-200,y:0},!0)})},n.getItem("switchStatus").then(function(e){i(_.isArray(e)?e[0]:e)},function(){i(!0)}),t.$on("updateJSON",function(t,n){var a=new Blob([n],{type:"application/json"});e.blobURL=URL.createObjectURL(a)})}angular.module("VSB.layout",["VSB.layout.workspace","VSB.layout.workspace.navigation","VSB.layout.result","VSB.language","ui.router"]).controller("NavigationCtrl",n).config(e).run(t),e.$inject=["$stateProvider","$urlRouterProvider"],t.$inject=["$rootScope","$state"],n.$inject=["$scope","$rootScope","$localForage","ArrowService","$timeout"]}(),function(){"use strict";function e(e){return function(t){if(!_.isString(t))return t;for(var n in e.prefixes)if(e.prefixes.hasOwnProperty(n)){var a=new RegExp("<?"+e.prefixes[n]+"(\\w+)>?","ig");t=t.replace(a,n+":$1")}return t}}function t(){return function(e){return e.replace(/<http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#type>/gi,"a").replace(/where\s+/gi,"WHERE \n").replace(/limit/gi,"LIMIT").replace(/ +\.\s+/gi," .\n").replace(/ +;\s+/gi," .\n").replace(/\{/gi,"\n{\n").replace(/}\s+/gi,"\n}\n").replace(/^\?/gim,"	?").replace(/^FILTER/gim,"	FILTER").replace(/^BIND/gim,"	BIND").replace(/select distinct\s+/gi,"SELECT DISTINCT \n")}}angular.module("VSB.filters",["VSB.config"]).filter("replaceURIsWithPrefixes",e).filter("beautifySPARQL",t),e.$inject=["globalConfig"]}(),function(){"use strict";function e(e,t,n,a,r){var i={},s=new Jassa(Promise,function(t){var n=Promise.defer(),a=s.util.PromiseUtils.createDeferred(!0);return t.timeout=n.promise,t.params=t.data,delete t.data,e(t).success(a.resolve).error(a.reject),a.promise()["catch"](Promise.TimeoutError,Promise.CancellationError,function(e){throw n.resolve(),e})}),o=s.sparql,l=s.service,c=s.sponate,u=new l.SparqlServiceHttp(a.baseURL,a.defaultGraphURIs);u=new l.SparqlServiceCache(u);var p=new c.StoreFacade(u,a.prefixes);i.runSponateMap=function(e){var t=e.name,n=["de","en",""],a=new o.BestLabelConfig(n),r=c.MappedConceptUtils.createMappedConceptBestLabel(a);e.template[0].rows[0]=_.mapValues(e.template[0].rows[0],function(e,t){return _.startsWith(t,"$")?{id:e,label:{$ref:{target:r,on:e,attr:"displayLabel"}}}:e}),p.addMap(e);var i=p[t].find().limit(100);return i.list()};var d=function(e){return null===e||void 0===e?e:e.replace(/^<+/,"").replace(/>+$/,"")};i.extractLabelFromURI=function(e){e=d(e);var t=e.lastIndexOf("#"),n=e.lastIndexOf("/");return e.substr(t>n?t+1:n+1)};var f=function(e,n,a){var s=!1,o=[];return n.forEach(function(t){o.push(r.setItem(t.id,e+".$label",t.value)),s=s||"default"===t.id}),s||o.push(r.setItem("default",e+".$label",i.extractLabelFromURI(e))),a.forEach(function(t){o.push(r.setItem(t.id,e+".$comment",t.value))}),t.all(o)};i.getPropertyType=function(e){var t=_.find(a.propertyTypeByType,function(t,n){return new RegExp(n).test(e.$type)});return t?t:(t=_.find(a.propertyTypeByRange,function(t,n){return new RegExp(n).test(e.$range)}),t?t:"STANDARD_PROPERTY")},i.getAvailableClasses=function(e){p.hasOwnProperty("classes")||p.addMap({name:"classes",template:[{id:"?uri",$labels:[{id:"?label_loc",value:"?label"}],$comments:[{id:"?comment_loc",value:"?comment"}]}],from:a.endPointQueries.getAvailableClasses});var n=p.classes.find();return n.list().then(function(n){var a=[];return n=_.pluck(n,"val"),e&&(n=_.filter(n,{id:d(e)})),n.forEach(function(e){e.uri=d(e.id),a.push(f(e.uri,e.$labels,e.$comments))}),t.all(a).then(function(){return n})})};var m=function(e,t,a){p.hasOwnProperty(a+e)||p.addMap({name:a+e,template:[{id:"?uri"}],from:t});var r=p[a+e].find();return r.list().then(function(e){return _.pluck(_.pluck(e,"val"),"id")},function(e){return n.error("An error occurred: ",e),[]})};i.getSuperAndEqClasses=function(e){return m(d(e),a.endPointQueries.getSuperAndEqClasses.replace("%uri%",d(e)),"SuperAndEqClasses")},i.getSubAndEqClasses=function(e){return m(d(e),a.endPointQueries.getSubAndEqClasses.replace("%uri%",d(e)),"SubAndEqClasses")};var g=function(e,t,n,r){var s=n?"InverseProperties":"DirectProperties";p.hasOwnProperty(s+e)||p.addMap({name:s+e,template:[{id:"?uri",$labels:[{id:"?label_loc",value:"?label"}],$comments:[{id:"?comment_loc",value:"?comment"}],$range:[{id:"?range"}],$type:"?type"}],from:t});var o=p[s+e].find();return o.list().then(function(e){return e=_.pluck(e,"val"),r&&(e=_.filter(e,{id:d(r)})),n||(e=_.union([],e,angular.copy(a.defaultProperties),angular.copy(a.aggregateFunctions))),e.forEach(function(e){e.$range=_.pluck(e.$range,"id"),e.uri=d(e.id),delete e.id,f(e.uri,e.$labels,e.$comments),n?e.type="INVERSE_PROPERTY":e.type||(e.type=i.getPropertyType(e))}),e})};return i.getDirectProperties=function(e,t){return g(d(e),a.endPointQueries.getDirectProperties.replace("%uri%",e),!1,t)},i.getInverseProperties=function(e,t){return g(d(e),a.endPointQueries.getInverseProperties.replace("%uri%",e),!0,t)},i.getPropertyDetails=function(e,t){return"INVERSE_PROPERTY"===t.type?i.getInverseProperties(d(e),t.uri):i.getDirectProperties(d(e),t.uri)},i.getPossibleRelations=function(e,t){var r=e+t;p.hasOwnProperty(r)||p.addMap({name:r,template:[{id:"?uri"}],from:a.endPointQueries.getPossibleRelation.replace("%uri1%",e).replace("%uri2%",t)});var i=p[r].find();return i.list().then(function(e){return e=_(e).pluck("val").pluck("id").value()},function(e){return n.error("An error occurred: ",e),[]})},i}angular.module("VSB.endPointService",["VSB.config"]).factory("EndPointService",e),e.$inject=["$http","$q","$log","globalConfig","languageStorage"]}(),function(){"use strict";function e(e,t,n,a,r){var i={steps:[{intro:'{{ "HELP_FIRST" | translate}}',tooltipClass:"wide"},{intro:"<div><h2>Arbeitsfläche</h2><p>Im Hintergrund sehen Sie die Arbeitsfläche, das Kernstück des VSB.... </p></div>"},{element:"#navigation",intro:"<div><h2>Navigation</h2><p>Here will be an explanation for the tour</p></div>",position:"right"},{intro:"<div>This is it for now.</div>",position:"Future implementations will hold more helpful information"}],showBullets:!0,exitOnOverlayClick:!0,exitOnEsc:!0,showStepNumbers:!1,nextLabel:'Weiter <i class="fa fa-chevron-right"></i>',prevLabel:'<i class="fa fa-chevron-left"></i> Zurück',skipLabel:"Abbruch",doneLabel:"Fertig"},s=null;r.$on("$translateChangeSuccess",function(t,o){if(o.language!==s){s=o.language;var l=angular.copy(i);l.steps=_.map(l.steps,function(e){var t=r.$new(!1),i=a("<div>"+e.intro+"</div>")(t),s=n(i);return e.intro=s(t)[0].outerHTML,e}),e.IntroOptions=l}}),e.saveJSON=function(){e.$broadcast("saveJsonEvent")},e.initializeWorkspace=function(){t.debug("Initialized Workspace"),e.translatedJSON="In the near future the translated JSON will be here.",e.translatedSPARQL="In the near future the translated SPARQL will be here."},e.initializeWorkspace()}angular.module("VSB.mainCtrl",["VSB.config","angular-intro"]).controller("MainCtrl",e),e.$inject=["$scope","$log","$compile","$interpolate","$rootScope"]}(),function(){"use strict";angular.module("VSB.config",[]).constant("globalConfig",{name:"STANDARD_CONFIG",propertyTypeByType:{"http://www.w3.org/2002/07/owl#ObjectProperty":"RELATION_PROPERTY"},propertyTypeByRange:{"http://vsb.leipert.io/ns/":"RELATION_PROPERTY","http://xmlns.com/foaf/0.1/":"RELATION_PROPERTY","http://www.w3.org/2001/XMLSchema#(integer|float|double|decimal|positiveInteger|nonNegativeInteger)":"NUMBER_PROPERTY","http://www.w3.org/2001/XMLSchema#(string|literal)":"STRING_PROPERTY","http://www.w3.org/2001/XMLSchema#date":"DATE_PROPERTY"},prefixes:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",foaf:"http://xmlns.com/foaf/0.1/",owl:"http://www.w3.org/2002/07/owl#",vsb:"http://vsb.leipert.io/ns/"},resultFormats:[{name:"HTML",format:"text/html"},{name:"editable Query",format:"text/html",qtxt:!0},{name:"XML",format:"application/sparql-results+xml"},{name:"JSON",format:"application/sparql-results+json"},{name:"CSV",format:"text/csv"},{name:"TSV",format:"text/tab-separated-values"},{name:"Excel",format:"application/vnd.ms-excel"},{name:"Turtle",format:"text/turtle"},{name:"RDF XML",format:"application/rdf+xml"},{name:"N-TRIPLE",format:"text/plain"},{name:"Javascript",format:"application/javascript"}],defaultProperties:[{id:"http://www.w3.org/2000/01/rdf-schema#label",$labels:[{id:"default",value:"Label"}],$comments:[{id:"default",value:"This is the label of this subject."}],type:"STRING_PROPERTY"},{id:"$$uri",$labels:[{id:"default",value:"uri"}],$comments:[{id:"default",value:"The uri of this subject."}],type:"STRING_PROPERTY"}],defaultGraphURIs:[],baseURL:"https://leipert.io/sparql",resultURL:"https://leipert.io/sparql?timeout=5000&debug=on",allowedLanguages:["*","de","en"],fallBackLanguages:["en"],aggregateFunctions:[{id:"$$count",$labels:[{id:"default",value:"Count property"}],$comments:[{id:"default",value:"Counts how often a subject has a certain property."}],operator:"COUNT(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:null},{id:"$$concat",$labels:[{id:"default",value:"Concat property"}],$comments:[{id:"default",value:"Concats all values of the same property URI."}],operator:'GROUP_CONCAT(%alias%,", ")',type:"AGGREGATE_PROPERTY",restrictTo:null},{id:"$$sum",$labels:[{id:"default",value:"Sum a property"}],$comments:[{id:"default",value:"Sums up all values a number property."}],operator:"SUM(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$avg",$labels:[{id:"default",value:"Average a property"}],$comments:[{id:"default",value:"Returns the average of a number property."}],operator:"AVG(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$min",$labels:[{id:"default",value:"Get minimum of a property"}],$comments:[{id:"default",value:"Returns the minimum of a number property."}],operator:"MIN(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"},{id:"$$max",$labels:[{id:"default",value:"Get maximum of a property"}],$comments:[{id:"default",value:"Returns the maximum of a number property."}],operator:"MAX(%alias%)",type:"AGGREGATE_PROPERTY",restrictTo:"NUMBER_PROPERTY"}],endPointQueries:{getDirectProperties:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class .?uri rdfs:domain ?class .OPTIONAL { ?uri rdfs:range ?range }  .OPTIONAL { ?uri rdf:type ?type }  .OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc) } .FILTER ( !isBlank(?class) && !isBlank(?uri) && !isBlank(?range) ) ",getInverseProperties:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class .?uri rdfs:range ?class .OPTIONAL { ?uri rdfs:domain ?range }  .OPTIONAL { ?uri rdf:type ?type }  .OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc) } .FILTER ( !isBlank(?class) && !isBlank(?uri) && !isBlank(?range) ) ",getSuperAndEqClasses:"<%uri%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?uri FILTER ( !isBlank(?uri) )",getSubAndEqClasses:"<%uri%> (^rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?uri FILTER ( !isBlank(?uri) )",getAvailableClasses:"{?uri a rdfs:Class .} UNION {?uri a owl:Class .} .FILTER ( !isBlank(?uri) )OPTIONAL { ?uri rdfs:label ?label . BIND(LANG(?label) AS ?label_loc) } .OPTIONAL { ?uri rdfs:comment ?comment . BIND(LANG(?comment) AS ?comment_loc)} ",getPossibleRelation:"<%uri1%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class1 .<%uri2%> (rdfs:subClassOf|(owl:equivalentClass|^owl:equivalentClass))* ?class2 .{ ?uri rdfs:domain ?class1 . ?uri rdfs:range ?class2  .} UNION { ?uri rdfs:domain ?class2 . ?uri rdfs:range ?class1  .}"}})
}();